{"version":3,"file":"BiliBili.js","sources":["../../../src/client/composables/size.ts","../../../src/client/components/BiliBili.ts"],"sourcesContent":["import { useEventListener } from \"@vueuse/core\";\nimport { computed, onMounted, isRef, ref, unref, watch } from \"vue\";\nimport type { MaybeRef } from \"@vueuse/core\";\nimport type { Ref } from \"vue\";\n\nconst getValue = (value: string | number): string =>\n  typeof value === \"string\" ? value : `${value}px`;\n\nexport interface SizeOptions {\n  width: string | number | undefined;\n  height: string | number | undefined;\n  ratio: number | undefined;\n}\n\nexport interface SizeInfo<E extends HTMLElement> {\n  el: Ref<E | undefined>;\n  width: Ref<string>;\n  height: Ref<string>;\n}\n\nexport const useSize = <E extends HTMLElement>(\n  options: SizeOptions,\n  extraHeight: MaybeRef<number> = 0\n): SizeInfo<E> => {\n  const el = ref<E>();\n  const width = computed(() => getValue(unref(options.width) || \"100%\"));\n  const height = ref(\"auto\");\n\n  const getHeight = (width: number): string => {\n    const height = unref(options.height);\n    const ratio = unref(options.ratio) || 16 / 9;\n\n    return height\n      ? getValue(height)\n      : `${Number(width) / ratio + unref(extraHeight)}px`;\n  };\n\n  const updateHeight = (): void => {\n    height.value = getHeight(el.value!.clientWidth);\n  };\n\n  onMounted(() => {\n    updateHeight();\n    if (isRef(extraHeight)) watch(extraHeight, () => updateHeight());\n    useEventListener(\"orientationchange\", () => updateHeight());\n    useEventListener(\"resize\", () => updateHeight());\n  });\n\n  return {\n    el,\n    width,\n    height,\n  };\n};\n","import { useEventListener } from \"@vueuse/core\";\nimport { checkIsMobile } from \"vuepress-shared/client\";\nimport { computed, defineComponent, h, onMounted, ref } from \"vue\";\nimport { useSize } from \"../composables/index.js\";\n\nimport type { VNode } from \"vue\";\n\nimport \"../styles/bilibli.scss\";\n\nexport default defineComponent({\n  name: \"BiliBili\",\n\n  props: {\n    bvid: {\n      type: String,\n      required: true,\n    },\n\n    page: {\n      type: Number,\n      default: 1,\n    },\n\n    width: {\n      type: [String, Number],\n      default: \"100%\",\n    },\n\n    height: {\n      type: [String, Number],\n      default: undefined,\n    },\n\n    ratio: {\n      type: Number,\n      default: 16 / 9,\n    },\n\n    time: {\n      type: Number,\n      default: 0,\n    },\n\n    highQuality: {\n      type: Boolean,\n      default: true,\n    },\n\n    danmaku: {\n      type: Boolean,\n      default: true,\n    },\n  },\n\n  setup(props) {\n    const isMobile = ref(false);\n    // on pc with width >= 640, a 68px hint will be under video\n    const extraHeight = computed(() => (isMobile.value ? 0 : 68));\n\n    const updateMobile = (): void => {\n      isMobile.value =\n        checkIsMobile(navigator.userAgent) || el.value!.clientWidth < 640;\n    };\n\n    onMounted(() => {\n      updateMobile();\n      useEventListener(\"orientationchange\", () => updateMobile());\n      useEventListener(\"resize\", () => updateMobile());\n    });\n\n    const { el, width, height } = useSize<HTMLIFrameElement>(\n      props,\n      extraHeight\n    );\n\n    return (): VNode | null =>\n      h(\"iframe\", {\n        ref: el,\n        // Tip: `https://www.bilibili.com/blackboard/newplayer.html?bvid=${props.bvid}&as_wide=1&page=1` only support whitelist sites now\n        src: `https://player.bilibili.com/player.html?bvid=${props.bvid}&t=${\n          props.time\n        }&high_quality=${props.highQuality ? 1 : 0}&page=${\n          props.page\n        }&danmaku=${props.danmaku ? 1 : 0}`,\n        class: \"bilibili-iframe\",\n        allow:\n          \"accelerometer; autoplay; clipboard-write; encrypted-media; fullscreen; gyroscope; picture-in-picture\",\n        style: {\n          width: width.value,\n          height: height.value,\n        },\n      });\n  },\n});\n"],"names":["getValue","value","useSize","options","extraHeight","el","ref","width","computed","unref","height","getHeight","ratio","updateHeight","onMounted","isRef","watch","useEventListener","BiliBili","defineComponent","props","isMobile","updateMobile","checkIsMobile","h"],"mappings":"0PAKA,MAAMA,EAAYC,GAChB,OAAOA,GAAU,SAAWA,EAAQ,GAAGA,MAc5BC,EAAU,CACrBC,EACAC,EAAgC,IAChB,CAChB,MAAMC,EAAKC,IACLC,EAAQC,EAAS,IAAMR,EAASS,EAAMN,EAAQ,KAAK,GAAK,MAAM,CAAC,EAC/DO,EAASJ,EAAI,MAAM,EAEnBK,EAAaJ,GAA0B,CAC3C,MAAMG,EAASD,EAAMN,EAAQ,MAAM,EAC7BS,EAAQH,EAAMN,EAAQ,KAAK,GAAK,GAAK,EAE3C,OAAOO,EACHV,EAASU,CAAM,EACf,GAAG,OAAOH,CAAK,EAAIK,EAAQH,EAAML,CAAW,KAClD,EAEMS,EAAe,IAAY,CAC/BH,EAAO,MAAQC,EAAUN,EAAG,MAAO,WAAW,CAChD,EAEA,OAAAS,EAAU,IAAM,CACdD,IACIE,EAAMX,CAAW,GAAGY,EAAMZ,EAAa,IAAMS,EAAc,CAAA,EAC/DI,EAAiB,oBAAqB,IAAMJ,EAAc,CAAA,EAC1DI,EAAiB,SAAU,IAAMJ,EAAc,CAAA,CACjD,CAAC,EAEM,CACL,GAAAR,EACA,MAAAE,EACA,OAAAG,CACF,CACF,EC5CA,IAAAQ,EAAeC,EAAgB,CAC7B,KAAM,WAEN,MAAO,CACL,KAAM,CACJ,KAAM,OACN,SAAU,EACZ,EAEA,KAAM,CACJ,KAAM,OACN,QAAS,CACX,EAEA,MAAO,CACL,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAEA,OAAQ,CACN,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAEA,MAAO,CACL,KAAM,OACN,QAAS,GAAK,CAChB,EAEA,KAAM,CACJ,KAAM,OACN,QAAS,CACX,EAEA,YAAa,CACX,KAAM,QACN,QAAS,EACX,EAEA,QAAS,CACP,KAAM,QACN,QAAS,EACX,CACF,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAWf,EAAI,EAAK,EAEpBF,EAAcI,EAAS,IAAOa,EAAS,MAAQ,EAAI,EAAG,EAEtDC,EAAe,IAAY,CAC/BD,EAAS,MACPE,EAAc,UAAU,SAAS,GAAKlB,EAAG,MAAO,YAAc,GAClE,EAEAS,EAAU,IAAM,CACdQ,IACAL,EAAiB,oBAAqB,IAAMK,GAAc,EAC1DL,EAAiB,SAAU,IAAMK,GAAc,CACjD,CAAC,EAED,KAAM,CAAE,GAAAjB,EAAI,MAAAE,EAAO,OAAAG,CAAO,EAAIR,EAC5BkB,EACAhB,CACF,EAEA,MAAO,IACLoB,EAAE,SAAU,CACV,IAAKnB,EAEL,IAAK,gDAAgDe,EAAM,UACzDA,EAAM,qBACSA,EAAM,YAAc,EAAI,UACvCA,EAAM,gBACIA,EAAM,QAAU,EAAI,IAChC,MAAO,kBACP,MACE,uGACF,MAAO,CACL,MAAOb,EAAM,MACb,OAAQG,EAAO,KACjB,CACF,CAAC,CACL,CACF,CAAC"}