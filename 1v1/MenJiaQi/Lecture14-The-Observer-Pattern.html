<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.23" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.93" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Lecture 14 The Observer Pattern","image":["https://bornforthis.cn/gzh.jpg","https://bornforthis.cn/zsxq.jpg"],"datePublished":"2025-03-12T07:05:47.000Z","dateModified":"2025-07-04T03:57:54.000Z","author":[{"@type":"Person","name":"AI悦创"}]}</script><meta property="og:url" content="https://bornforthis.cn/1v1/MenJiaQi/Lecture14-The-Observer-Pattern.html"><meta property="og:site_name" content="AI悦创-Python一对一辅导"><meta property="og:title" content="Lecture 14 The Observer Pattern"><meta property="og:description" content="In the last lecture we introduced the idea of a “Features interface” that described a way to isolate the controller from the low-level Swing components inside the view, and simu..."><meta property="og:type" content="article"><meta property="og:image" content="https://bornforthis.cn/gzh.jpg"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-07-04T03:57:54.000Z"><meta property="article:author" content="AI悦创"><meta property="article:published_time" content="2025-03-12T07:05:47.000Z"><meta property="article:modified_time" content="2025-07-04T03:57:54.000Z"><link rel="shortcut icon" href="/aiyc.svg"><meta name="keywords" content="一对一辅导编程,编程1v1,CS辅导,编程一对一辅导,少儿编程一对一,Python 1v1,AI悦创,一对一,菜鸟教程,Python,编程一对一,C++,Java,AI,人工智能,黄家宝,Python一对一教学,Python辅导,留学生CS辅导,ChatGPT代注册"><meta name="description" content="Python一对一辅导,编程1v1,Java一对一辅导,一对一教学辅导,CS辅导,面试辅导,爬虫一对一教学,菜鸟教程,编程一对一教学,少儿编程一对一,人工智能,黄家宝,全网3000+学员,值得信赖,Python一对一教学,Java一对一教学,留学生CS辅导,ChatGPT代注册"><title>Lecture 14 The Observer Pattern | AI悦创-Python一对一辅导</title>
    <link rel="preload" href="/assets/style-CknMNbnY.css" as="style"><link rel="stylesheet" href="/assets/style-CknMNbnY.css">
    <link rel="modulepreload" href="/assets/app-BgxfbuhL.js"><link rel="modulepreload" href="/assets/Lecture14-The-Observer-Pattern.html-CMBBdzla.js"><link rel="modulepreload" href="/assets/gzh-DnOBNg6W.js"><link rel="modulepreload" href="/assets/zsxq-BcdwOI-_.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container no-sidebar external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="带我回家"><img class="vp-nav-logo" src="/aiyc.svg" alt><!----><span class="vp-site-name hide-in-pad">AI悦创-Python一对一辅导</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="黄家宝"><!--[--><i class="vp-icon iconfont icon-home" sizing="height"></i><!--]-->黄家宝<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/R-Course/" aria-label="R-Course"><!--[--><i class="vp-icon iconfont icon-cib-r" sizing="height"></i><!--]-->R-Course<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/Python/" aria-label="Python"><!--[--><i class="vp-icon iconfont icon-python" sizing="height"></i><!--]-->Python<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/Java/" aria-label="Java"><!--[--><i class="vp-icon iconfont icon-java" sizing="height"></i><!--]-->Java<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/1v1/" aria-label="1v1"><!--[--><i class="vp-icon iconfont icon-idea" sizing="height"></i><!--]-->1v1<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/AndersonHJB" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon iconfont icon-blog" sizing="height"></i>Lecture 14 The Observer Pattern</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">AI悦创</span></span><span property="author" content="AI悦创"></span></span><span class="page-original-info">原创</span><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2025/3/12</span><meta property="datePublished" content="2025-03-12T07:05:47.000Z"></span><span class="page-pageview-info" aria-label="访问量🔢" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon" name="eye"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="vp-pageview waline-pageview-count" data-path="/1v1/MenJiaQi/Lecture14-The-Observer-Pattern.html" data-page-key="/1v1/MenJiaQi/Lecture14-The-Observer-Pattern.html">...</span></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 18 分钟</span><meta property="timeRequired" content="PT18M"></span><!----><!----></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><p>In the <a href="https://course.ccs.neu.edu/cs3500/lec_gui_basics_notes.html" target="_blank" rel="noopener noreferrer">last lecture</a> we introduced the idea of a “<code>Features</code> interface” that described a way to</p><ul><li>isolate the controller from the low-level Swing components inside the view, and</li><li>simultaneously, allow the view to have multiple UI components trigger the same logical callback on the controller.</li></ul><p>We called these “high-level events”, since they were application-specific events as opposed to “low-level” general-purpose events. This idea of defining our own application-specific events is a very common one, and generalizes the <code>Features</code> interface idea into something known as the Observer Patern.</p><h2 id="_1-motivating-example-buying-concert-tickets" tabindex="-1"><a class="header-anchor" href="#_1-motivating-example-buying-concert-tickets"><span>1. Motivating example: buying concert tickets</span></a></h2><p>Suppose you are interested in getting tickets for a popular upcoming concert. You know that tickets will sell out quickly, and you don’t want to miss your opportunity. So you signup for the mailing list for the ticket service, and wait for an email telling you that tickets are now available. Of course, mailing lists being what they are, you’ll probably get a bunch of unwanted messages telling you about uninteresting concerts as well, so you need to read the emails to check which concert has just gone on sale.</p><p>Let’s try to represent this in code.</p><h2 id="_2-setting-the-stage" tabindex="-1"><a class="header-anchor" href="#_2-setting-the-stage"><span>2. Setting the stage</span></a></h2><p>Let’s assume we have a <code>class TicketSeller</code> that handles ticket sales for lots of concerts, and a <code>class Person</code> to represent you or other people interested in concerts. (To keep things simple, we’ll just assume each concert has a unique name that we’ll represent as a <code>String</code>; in practice, the data here might be more interesting, but it’ll obscure the pattern we’re looking for here.)</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">TicketSeller</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  Ticket</span><span style="color:#A6E22E;"> purchaseTicketFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) { ... sell a ticket ... }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Person</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  void</span><span style="color:#A6E22E;"> tryToBuyTicketFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F92672;">    ???</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If a concert is sold out or not even available yet, then <code>TicketSeller#purchaseTicketFor</code> will fail, so our goal is to call that method as soon as possible, but no sooner. So in <code>Person#tryToBuyTicketsFor</code>, we can’t immediately call that method. Instead, we need to “sign up for the mailing list” somehow.</p><p>To do that, let’s define an interface</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">interface</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  void</span><span style="color:#A6E22E;"> ticketsAvailableFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This is the analogue of the <code>Features</code> interface from last lecture. With <code>Features</code>, our controller was interested in being called back, so it registered with the view, and the view called its methods when appropriate. Here, our <code>TicketSeller</code> will call the <code>ticketsAvailableFor</code> method on any objects that have signed up for such notifications, and our <code>Person</code> objects will implement that interface and sign up for the notifications.</p><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Person</span><span style="color:#F92672;"> implements</span><span> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  void</span><span style="color:#A6E22E;"> tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;font-style:italic;">TicketSeller</span><span style="color:#FD971F;font-style:italic;"> seller</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">    seller.</span><span style="color:#A6E22E;">signUpForNotifications</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">  public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> ticketsAvailableFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#88846F;">    // the seller will call us back when concerts become available</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">TicketSeller</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  void</span><span style="color:#A6E22E;"> signUpforNotifications</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#FD971F;font-style:italic;"> obs</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F92672;">    ???</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>Now we just have to connect the last few pieces. The <code>TicketSeller</code> will need to maintain a “mailing list” of everyone who’s signed up to be notified. And whenever a new concert is announced, it should broadcast that announcement to everyone who’s signed up:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">TicketSeller</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  List</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;">&gt; subscriers </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#66D9EF;font-style:italic;"> ArrayList</span><span style="color:#F8F8F2;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  void</span><span style="color:#A6E22E;"> signUpForNotifications</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#FD971F;font-style:italic;"> sub</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#FD971F;">    this</span><span style="color:#F8F8F2;">.subscribers.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(sub);</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  void</span><span style="color:#A6E22E;"> announceNewConcert</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> name</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> (</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> sub </span><span style="color:#F92672;">:</span><span style="color:#FD971F;"> this</span><span style="color:#F8F8F2;">.subscribers) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      sub.</span><span style="color:#A6E22E;">ticketsAvailableFor</span><span style="color:#F8F8F2;">(name);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Finally, we can complete the <code>Person</code> implementation. Notice that they’ll get notified for <em>all</em> concerts, so they need to keep track of the one concert they’re interested in:</p><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Person</span><span style="color:#F92672;"> implements</span><span> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  String</span><span style="color:#F8F8F2;"> interestedInConcert;</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  TicketSeller</span><span style="color:#F8F8F2;"> seller;</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  void</span><span style="color:#A6E22E;"> tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;font-style:italic;">TicketSeller</span><span style="color:#FD971F;font-style:italic;"> seller</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#FD971F;">    this</span><span style="color:#F8F8F2;">.interestedInConcert </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> concertName;</span></span>
<span class="line"><span style="color:#FD971F;">    this</span><span style="color:#F8F8F2;">.seller </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> seller;</span></span>
<span class="line"><span style="color:#F8F8F2;">    seller.</span><span style="color:#A6E22E;">signUpForNotifications</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">  public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> ticketsAvailableFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F92672;">    if</span><span style="color:#F8F8F2;"> (concertName.</span><span style="color:#A6E22E;">equals</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.interestedInConcert)) {</span></span>
<span class="line"><span style="color:#88846F;">      // Hooray, tickets are available for the concert we&#39;re interested in</span></span>
<span class="line"><span style="color:#F8F8F2;">      seller.</span><span style="color:#A6E22E;">purchaseTicketFor</span><span style="color:#F8F8F2;">(concertName);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>Notice the similarities to <code>ActionListener</code>s: the <code>Person</code> gets called back with the name of what event has occurred, and can choose what to do about it based on that information. Notice also the differences: the callback here is talking about <em>concerts</em>, which is clearly a very application-specific sort of event.</p><h2 id="_3-enhancements-and-subtleties" tabindex="-1"><a class="header-anchor" href="#_3-enhancements-and-subtleties"><span>3. Enhancements and subtleties</span></a></h2><p>The names <code>TicketSeller</code>, <code>signUpForNotifications</code>, <code>TicketNotificationSubscriber</code> and <code>ticketsAvailableFor</code> are whimsical and application-specific, but they illustrate an important point: this pattern applies to high-level events just as well as to low-level events. Regardless of the name, the Observer Pattern describes this common scenario, of multiple entities that are interested in messages being sent by some common source. There can be many observers for a single message-sender, and a single observer might be interested in many message-senders.</p><p>The general names for this pattern look as follows:</p><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Subject</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  List</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#66D9EF;font-style:italic;">Observer</span><span style="color:#F8F8F2;">&gt; observers;</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  void</span><span style="color:#A6E22E;"> addObserver</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">Observer</span><span style="color:#FD971F;font-style:italic;"> obs</span><span style="color:#F8F8F2;">) { observers.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(obs); }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">  // This method gets called by other methods in the Subject class as needed</span></span>
<span class="line"><span style="color:#F92672;">  private</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> notifyAllSomethingHappened</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> (</span><span style="color:#66D9EF;font-style:italic;">Observer</span><span style="color:#F8F8F2;"> obs </span><span style="color:#F92672;">:</span><span style="color:#FD971F;"> this</span><span style="color:#F8F8F2;">.observers) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      obs.</span><span style="color:#A6E22E;">somethingHappened</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">interface</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Observer</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  void</span><span style="color:#A6E22E;"> somethingHappend</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">SomeObserver</span><span style="color:#F92672;"> implements</span><span> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">Observer</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">  void</span><span style="color:#A6E22E;"> somethingHappened</span><span style="color:#F8F8F2;">() { ... }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">// somewhere in the code</span></span>
<span class="line"><span style="color:#F8F8F2;">someSubject.</span><span style="color:#A6E22E;">addObserver</span><span style="color:#F8F8F2;">(someObserver);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><ul><li>We might want to enhance the <code>Subject</code> class to allow <em>unsubscribing</em> from notifications, via a <code>removeObserver</code> method.</li><li>We might want to send more information along in the <code>somethingHappened</code> method, including which <code>Subject</code> sent the notification, or what the notification is about.</li><li>Currently, each <code>Person</code> gets notified for <em>all</em> concerts, leading to a lot of spammy messages. We might want to enhance the <code>addObserver</code> method to specify what notifications we’re interested in, and allow the <code>TicketSeller</code> to only send the notifications we care about. In general, we might want the <code>Subject</code> class to maintain a mapping from specific topics to the observers interested in just those topics, and only <code>somethingHappened()</code> the observers that care about that topic. This leads to a more complex <code>Subject</code> implementation, but a <em>possibly</em> more-efficient system overall.</li><li>Our current <code>Observer</code> interface has only a single method in it. But as we saw with <code>Features</code>, there could easily be multiple application-specific notifications we might want to send.</li><li>Thinking about the <code>TicketSeller</code> again, if it sends out a notification for each individual concert, then the amount of spam depends on how many concerts there are. We might instead want to group together several updates into a single <em>batch notification</em> (for example, configuring Piazza to notify you for each individual post, vs notifying you once every few hours with a batch of posts at once).</li></ul><p>The Observer pattern is a general-purpose event handling mechanism, and hopefully it’s clear that its utility generalizes beyond just handling UI events.</p><h2 id="_1-观察者模式要解决什么问题" tabindex="-1"><a class="header-anchor" href="#_1-观察者模式要解决什么问题"><span>1. 观察者模式要解决什么问题？</span></a></h2><p>在很多应用场景中，我们都有这样一种需求：<strong>当某个对象（通常称为“主题”Subject）发生变化时，希望能够及时通知其他对这个变化感兴趣的对象（通常称为“观察者”Observer）</strong></p><p>例如：文中“演唱会订票”例子里，<code>TicketSeller</code> 就好比是“主题”，有新演唱会门票开始发售（“事件”）时，需要通知所有“订阅”它的人（“观察者”），让他们赶紧来买票。</p><p>这个模式也常出现在 GUI 开发中，Swing 或其他图形库中都有类似的事件监听器概念：一个按钮被点击时，就通知所有监听这个按钮点击事件的观察者。</p><p><strong>关键点：</strong></p><ol><li>主题（Subject）维护一个观察者列表。</li><li>当主题发生变化时，就循环通知所有已注册（订阅）的观察者。</li><li>观察者可以有不同的逻辑，根据事件信息做出不同反应。</li></ol><h2 id="_2-先看一个简化的-演唱会订票-示例思路" tabindex="-1"><a class="header-anchor" href="#_2-先看一个简化的-演唱会订票-示例思路"><span>2. 先看一个简化的“演唱会订票”示例思路</span></a></h2><ol><li><strong>TicketNotificationSubscriber</strong>: 这是观察者接口(Observer)，表示“任何想订阅新演唱会通知”的人（或对象），必须实现此接口，并实现一个回调方法 <code>ticketsAvailableFor(String concertName)</code>，用来接收“通知”。</li><li><strong>TicketSeller</strong>: 这是主题(Subject)， <ul><li>会维护一个“已订阅”列表（List），里面放的都是实现了 <code>TicketNotificationSubscriber</code> 接口的对象。</li><li>当它宣布有新的演唱会（<code>announceNewConcert(String name)</code>）时，就会把这个消息广播给所有订阅者。</li></ul></li><li><strong>Person</strong>: 具体的观察者（Observer）的实现类之一， <ul><li>它想要订阅某个演唱会的门票通知，就调用 <code>seller.signUpForNotifications(this)</code> 把自己注册到 <code>TicketSeller</code>。</li><li>当收到通知 <code>ticketsAvailableFor(String concertName)</code>，就判断是不是自己关心的演唱会，如果是，就执行购买票的逻辑。</li></ul></li></ol><p>和我们常见的 GUI 监听器类似，但事件名是业务相关的“门票可用事件”，而非鼠标点击、键盘输入等底层事件，因此它也被称为“高层事件”或“应用特定事件”。</p><h2 id="_3-一步步带你实现" tabindex="-1"><a class="header-anchor" href="#_3-一步步带你实现"><span>3. 一步步带你实现</span></a></h2><p>下面我们写一个完整的示例，放在一个文件里演示。可以把它保存为 <code>ObserverPatternDemo.java</code> 并编译运行（当然也可以拆分成多个文件，这里为了演示方便，放在一起）。</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="v-0" aria-selected="true">第一步：定义观察者接口</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-1" aria-selected="false">第二步：定义主题（Subject），即卖票方</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-2" aria-selected="false">第三步：实现具体的观察者</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-3" aria-selected="false">第四步：在 main 方法中运行示例</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-4" aria-selected="false">All Code</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="v-5" aria-selected="false">完整注释</button></div><!--[--><div class="vp-tab active" id="v-0" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">第一步：定义观察者接口</div><!--[--><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#88846F;">// Observer接口：订阅者都要实现这个接口</span></span>
<span class="line"><span style="color:#F92672;">interface</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 当演唱会门票可用时被通知的方法</span></span>
<span class="line"><span style="color:#88846F;">     * </span><span style="color:#F92672;">@param</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#88846F;"> 演唱会名字</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">    void</span><span style="color:#A6E22E;"> ticketsAvailableFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个接口的作用就和我们在前面讲义中看到的 <code>TicketNotificationSubscriber</code> 一样，只有一个方法 <code>ticketsAvailableFor(String concertName)</code>，表示“有新票时的通知回调”。</p><!--]--></div><div class="vp-tab" id="v-1" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">第二步：定义主题（Subject），即卖票方</div><!--[--><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">import</span><span style="color:#F92672;"> java.util.ArrayList</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F92672;"> java.util.List</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">TicketSeller</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#88846F;">    // 维护一个观察者的列表，谁订阅了就放进来</span></span>
<span class="line"><span style="color:#F92672;">    private</span><span style="color:#66D9EF;font-style:italic;"> List</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;">&gt; subscribers </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#66D9EF;font-style:italic;"> ArrayList</span><span style="color:#F8F8F2;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 订阅（注册）方法，任何实现了TicketNotificationSubscriber的人都能订阅通知</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> signUpForNotifications</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#FD971F;font-style:italic;"> subscriber</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#FD971F;">        this</span><span style="color:#F8F8F2;">.subscribers.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(subscriber);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 主题所发送的事件，例如宣布某个演唱会有新票了</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> announceNewConcert</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【TicketSeller】宣布演唱会 &quot;</span><span style="color:#F92672;"> +</span><span style="color:#F8F8F2;"> concertName </span><span style="color:#F92672;">+</span><span style="color:#E6DB74;"> &quot; 可以购票了！&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#88846F;">        // 遍历所有订阅者，逐一通知</span></span>
<span class="line"><span style="color:#F92672;">        for</span><span style="color:#F8F8F2;"> (</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> sub </span><span style="color:#F92672;">:</span><span style="color:#FD971F;"> this</span><span style="color:#F8F8F2;">.subscribers) {</span></span>
<span class="line"><span style="color:#F8F8F2;">            sub.</span><span style="color:#A6E22E;">ticketsAvailableFor</span><span style="color:#F8F8F2;">(concertName);</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 购买门票的逻辑，这里简单演示一下，真实情况下可能有很多业务校验</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> purchaseTicketFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【TicketSeller】购买了演唱会 &quot;</span><span style="color:#F92672;"> +</span><span style="color:#F8F8F2;"> concertName </span><span style="color:#F92672;">+</span><span style="color:#E6DB74;"> &quot; 的门票。&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><ul><li><p><code>subscribers</code> 就是“谁已经订阅（sign up）了通知”这件事情。</p></li><li><p><code>announceNewConcert(String concertName)</code> 用来“发布/广播”某个新演唱会。</p></li><li><p><code>purchaseTicketFor(String concertName)</code> 简化地模拟购买流程，只是打印一下表示买到了票。</p></li></ul><!--]--></div><div class="vp-tab" id="v-2" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">第三步：实现具体的观察者</div><!--[--><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Person</span><span style="color:#F92672;"> implements</span><span> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#88846F;">    // 这个人只关心哪个演唱会</span></span>
<span class="line"><span style="color:#F92672;">    private</span><span style="color:#66D9EF;font-style:italic;"> String</span><span style="color:#F8F8F2;"> interestedConcert;</span></span>
<span class="line"><span style="color:#88846F;">    // 保存一个对TicketSeller的引用，为了后续去调用purchaseTicketFor</span></span>
<span class="line"><span style="color:#F92672;">    private</span><span style="color:#66D9EF;font-style:italic;"> TicketSeller</span><span style="color:#F8F8F2;"> seller;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 让这个人开始订阅某个演唱会的票务通知</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;font-style:italic;">TicketSeller</span><span style="color:#FD971F;font-style:italic;"> seller</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#FD971F;">        this</span><span style="color:#F8F8F2;">.interestedConcert </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> concertName;</span></span>
<span class="line"><span style="color:#FD971F;">        this</span><span style="color:#F8F8F2;">.seller </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> seller;</span></span>
<span class="line"><span style="color:#88846F;">        // 告诉卖票的人：我要订阅你们的“新演唱会消息”</span></span>
<span class="line"><span style="color:#F8F8F2;">        seller.</span><span style="color:#A6E22E;">signUpForNotifications</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 真正收到通知时，会被TicketSeller调用</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#66D9EF;font-style:italic;">Override</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> ticketsAvailableFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【Person】收到通知：演唱会 &quot;</span><span style="color:#F92672;"> +</span><span style="color:#F8F8F2;"> concertName </span><span style="color:#F92672;">+</span><span style="color:#E6DB74;"> &quot; 票来了！&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#88846F;">        // 如果是我感兴趣的那个演唱会，就立刻去买票</span></span>
<span class="line"><span style="color:#F92672;">        if</span><span style="color:#F8F8F2;"> (concertName.</span><span style="color:#A6E22E;">equals</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.interestedConcert)) {</span></span>
<span class="line"><span style="color:#F8F8F2;">            System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【Person】正是我想看的演唱会！赶紧买票！&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">            seller.</span><span style="color:#A6E22E;">purchaseTicketFor</span><span style="color:#F8F8F2;">(concertName);</span></span>
<span class="line"><span style="color:#F8F8F2;">        } </span><span style="color:#F92672;">else</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">            System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【Person】但这场演唱会我不感兴趣。&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><ul><li><code>tryToBuyTicketsFor</code> 是我们在“现实场景”里点“我要订阅这个演唱会信息”的动作。</li><li><code>ticketsAvailableFor</code> 是收到通知后，这个 <code>Person</code> 要做出的响应。只有当通知的演唱会正好是 <code>interestedConcert</code>，才会真正去购买，否则不管。</li></ul><!--]--></div><div class="vp-tab" id="v-3" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">第四步：在 main 方法中运行示例</div><!--[--><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">public</span><span style="color:#F92672;"> class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">ObserverPatternDemo</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#F92672;"> static</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> main</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#F8F8F2;">[] </span><span style="color:#FD971F;font-style:italic;">args</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#88846F;">        // 1. 创建主题（卖票方）</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">        TicketSeller</span><span style="color:#F8F8F2;"> ticketSeller </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> TicketSeller</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">        // 2. 创建几个观察者</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">        Person</span><span style="color:#F8F8F2;"> alice </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Person</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">        Person</span><span style="color:#F8F8F2;"> bob </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Person</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">        // 3. 分别让alice和bob订阅自己感兴趣的演唱会</span></span>
<span class="line"><span style="color:#F8F8F2;">        alice.</span><span style="color:#A6E22E;">tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;周杰伦演唱会&quot;</span><span style="color:#F8F8F2;">, ticketSeller);</span></span>
<span class="line"><span style="color:#F8F8F2;">        bob.</span><span style="color:#A6E22E;">tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;林俊杰演唱会&quot;</span><span style="color:#F8F8F2;">, ticketSeller);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">        // 4. 卖票方宣布演唱会开始，看看谁会收到通知并且行动</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;</span><span style="color:#AE81FF;">\n</span><span style="color:#E6DB74;">=== 第一次宣布：周杰伦演唱会 ===&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        ticketSeller.</span><span style="color:#A6E22E;">announceNewConcert</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;周杰伦演唱会&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;</span><span style="color:#AE81FF;">\n</span><span style="color:#E6DB74;">=== 第二次宣布：林俊杰演唱会 ===&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        ticketSeller.</span><span style="color:#A6E22E;">announceNewConcert</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;林俊杰演唱会&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>运行后，你会看到类似下面的输出(示例)：</p><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> 第一次宣布：周杰伦演唱会 </span><span style="color:#F92672;">===</span></span>
<span class="line"><span style="color:#F8F8F2;">【TicketSeller】宣布演唱会 周杰伦演唱会 可以购票了！</span></span>
<span class="line"><span style="color:#F8F8F2;">【Person】收到通知：演唱会 周杰伦演唱会 票来了！</span></span>
<span class="line"><span style="color:#F8F8F2;">【Person】正是我想看的演唱会！赶紧买票！</span></span>
<span class="line"><span style="color:#F8F8F2;">【TicketSeller】购买了演唱会 周杰伦演唱会 的门票。</span></span>
<span class="line"><span style="color:#F8F8F2;">【Person】收到通知：演唱会 周杰伦演唱会 票来了！</span></span>
<span class="line"><span style="color:#F8F8F2;">【Person】但这场演唱会我不感兴趣。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">===</span><span style="color:#F8F8F2;"> 第二次宣布：林俊杰演唱会 </span><span style="color:#F92672;">===</span></span>
<span class="line"><span style="color:#F8F8F2;">【TicketSeller】宣布演唱会 林俊杰演唱会 可以购票了！</span></span>
<span class="line"><span style="color:#F8F8F2;">【Person】收到通知：演唱会 林俊杰演唱会 票来了！</span></span>
<span class="line"><span style="color:#F8F8F2;">【Person】但这场演唱会我不感兴趣。</span></span>
<span class="line"><span style="color:#F8F8F2;">【Person】收到通知：演唱会 林俊杰演唱会 票来了！</span></span>
<span class="line"><span style="color:#F8F8F2;">【Person】正是我想看的演唱会！赶紧买票！</span></span>
<span class="line"><span style="color:#F8F8F2;">【TicketSeller】购买了演唱会 林俊杰演唱会 的门票。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>可以看到，</p><ul><li><strong>主题</strong>(<code>TicketSeller</code>) 在 <code>announceNewConcert(...)</code> 中将新演唱会的消息通知给所有<strong>观察者</strong>(<code>Person</code>)。</li><li>每个 <code>Person</code> 收到通知后都会各自做判断，只有对自己感兴趣的演唱会才会执行购买动作。</li><li>这就是观察者模式最核心的地方：<strong>“主题一旦发布消息，所有观察者都能收到，观察者可以根据自己需要决定如何处理。”</strong></li></ul><!--]--></div><div class="vp-tab" id="v-4" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">All Code</div><!--[--><p>下面给出的演示代码可以放在同一个文件 <code>ObserverPatternDemo.java</code> 中，包含所有类（<code>ObserverPatternDemo</code>、<code>TicketNotificationSubscriber</code>、<code>TicketSeller</code>、<code>Person</code>），这样可以直接编译并运行。完整结构如下：</p><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#F92672;">import</span><span style="color:#F92672;"> java.util.ArrayList</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F92672;"> java.util.List</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">/**</span></span>
<span class="line"><span style="color:#88846F;"> * 演示入口类：包含 main() 方法。</span></span>
<span class="line"><span style="color:#88846F;"> * 这里命名为 public class ObserverPatternDemo，其他类用包级可见（不加 public）即可。</span></span>
<span class="line"><span style="color:#88846F;"> */</span></span>
<span class="line"><span style="color:#F92672;">public</span><span style="color:#F92672;"> class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">ObserverPatternDemo</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#F92672;"> static</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> main</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#F8F8F2;">[] </span><span style="color:#FD971F;font-style:italic;">args</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#88846F;">        // 1. 创建主题（卖票方）</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">        TicketSeller</span><span style="color:#F8F8F2;"> ticketSeller </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> TicketSeller</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">        // 2. 创建几个观察者</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">        Person</span><span style="color:#F8F8F2;"> alice </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Person</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">        Person</span><span style="color:#F8F8F2;"> bob </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Person</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">        // 3. 分别让alice和bob订阅自己感兴趣的演唱会</span></span>
<span class="line"><span style="color:#F8F8F2;">        alice.</span><span style="color:#A6E22E;">tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;周杰伦演唱会&quot;</span><span style="color:#F8F8F2;">, ticketSeller);</span></span>
<span class="line"><span style="color:#F8F8F2;">        bob.</span><span style="color:#A6E22E;">tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;林俊杰演唱会&quot;</span><span style="color:#F8F8F2;">, ticketSeller);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">        // 4. 卖票方宣布演唱会开始，看看谁会收到通知并且行动</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;</span><span style="color:#AE81FF;">\n</span><span style="color:#E6DB74;">=== 第一次宣布：周杰伦演唱会 ===&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        ticketSeller.</span><span style="color:#A6E22E;">announceNewConcert</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;周杰伦演唱会&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;</span><span style="color:#AE81FF;">\n</span><span style="color:#E6DB74;">=== 第二次宣布：林俊杰演唱会 ===&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        ticketSeller.</span><span style="color:#A6E22E;">announceNewConcert</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;林俊杰演唱会&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">/**</span></span>
<span class="line"><span style="color:#88846F;"> * 观察者接口: 所有想要“订阅演唱会通知”的类，都要实现这个接口。</span></span>
<span class="line"><span style="color:#88846F;"> */</span></span>
<span class="line"><span style="color:#F92672;">interface</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">    void</span><span style="color:#A6E22E;"> ticketsAvailableFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">/**</span></span>
<span class="line"><span style="color:#88846F;"> * 主题（Subject）：卖票方。</span></span>
<span class="line"><span style="color:#88846F;"> * 维护一个观察者列表，宣布新演唱会时通知所有观察者。</span></span>
<span class="line"><span style="color:#88846F;"> */</span></span>
<span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">TicketSeller</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#88846F;">    // 维护一个观察者列表</span></span>
<span class="line"><span style="color:#F92672;">    private</span><span style="color:#66D9EF;font-style:italic;"> List</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;">&gt; subscribers </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#66D9EF;font-style:italic;"> ArrayList</span><span style="color:#F8F8F2;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 订阅/注册方法，让任何实现了 TicketNotificationSubscriber 的对象加进来</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> signUpForNotifications</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#FD971F;font-style:italic;"> subscriber</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#FD971F;">        this</span><span style="color:#F8F8F2;">.subscribers.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(subscriber);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 模拟宣布新的演唱会来临，并通知所有订阅者</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> announceNewConcert</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【TicketSeller】宣布演唱会 &quot;</span><span style="color:#F92672;"> +</span><span style="color:#F8F8F2;"> concertName </span><span style="color:#F92672;">+</span><span style="color:#E6DB74;"> &quot; 可以购票了！&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F92672;">        for</span><span style="color:#F8F8F2;"> (</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> sub </span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> subscribers) {</span></span>
<span class="line"><span style="color:#F8F8F2;">            sub.</span><span style="color:#A6E22E;">ticketsAvailableFor</span><span style="color:#F8F8F2;">(concertName);</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 简化的购票方法，这里仅做打印演示</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> purchaseTicketFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【TicketSeller】购买了演唱会 &quot;</span><span style="color:#F92672;"> +</span><span style="color:#F8F8F2;"> concertName </span><span style="color:#F92672;">+</span><span style="color:#E6DB74;"> &quot; 的门票。&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">/**</span></span>
<span class="line"><span style="color:#88846F;"> * 具体的观察者：实现了 TicketNotificationSubscriber 接口。</span></span>
<span class="line"><span style="color:#88846F;"> * 表示一个想买票的人。</span></span>
<span class="line"><span style="color:#88846F;"> */</span></span>
<span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Person</span><span style="color:#F92672;"> implements</span><span> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F92672;">    private</span><span style="color:#66D9EF;font-style:italic;"> String</span><span style="color:#F8F8F2;"> interestedConcert;  </span><span style="color:#88846F;">// 只关注这个演唱会</span></span>
<span class="line"><span style="color:#F92672;">    private</span><span style="color:#66D9EF;font-style:italic;"> TicketSeller</span><span style="color:#F8F8F2;"> seller;       </span><span style="color:#88846F;">// 持有 TicketSeller 引用以便购票</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 让这个人开始订阅并关注某个演唱会的门票通知</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;font-style:italic;">TicketSeller</span><span style="color:#FD971F;font-style:italic;"> seller</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#FD971F;">        this</span><span style="color:#F8F8F2;">.interestedConcert </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> concertName;</span></span>
<span class="line"><span style="color:#FD971F;">        this</span><span style="color:#F8F8F2;">.seller </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> seller;</span></span>
<span class="line"><span style="color:#88846F;">        // 注册到卖票方的“订阅”列表中</span></span>
<span class="line"><span style="color:#F8F8F2;">        seller.</span><span style="color:#A6E22E;">signUpForNotifications</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 收到票务通知的回调方法</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#66D9EF;font-style:italic;">Override</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> ticketsAvailableFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【Person】收到通知：演唱会 &quot;</span><span style="color:#F92672;"> +</span><span style="color:#F8F8F2;"> concertName </span><span style="color:#F92672;">+</span><span style="color:#E6DB74;"> &quot; 票来了！&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F92672;">        if</span><span style="color:#F8F8F2;"> (concertName.</span><span style="color:#A6E22E;">equals</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.interestedConcert)) {</span></span>
<span class="line"><span style="color:#F8F8F2;">            System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【Person】正是我想看的演唱会！赶紧买票！&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">            seller.</span><span style="color:#A6E22E;">purchaseTicketFor</span><span style="color:#F8F8F2;">(concertName);</span></span>
<span class="line"><span style="color:#F8F8F2;">        } </span><span style="color:#F92672;">else</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">            System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【Person】但这场演唱会我不感兴趣。&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><h3 id="代码结构与说明" tabindex="-1"><a class="header-anchor" href="#代码结构与说明"><span>代码结构与说明</span></a></h3><ol><li><strong>ObserverPatternDemo</strong><ul><li>这是主类 (有 <code>main</code> 方法)，代码运行的入口。</li><li>这里我们将所有类都放在同一个 <code>.java</code> 文件里，为演示方便。</li><li>在 Java 中只能有一个 <code>public</code> 类，且类名与文件名相同，其余类不加 <code>public</code> 关键字。</li></ul></li><li><strong>TicketNotificationSubscriber (观察者接口)</strong><ul><li>定义了一个方法 <code>ticketsAvailableFor(String concertName)</code>，表示当有演唱会信息发布时的回调。</li></ul></li><li><strong>TicketSeller (主题 Subject)</strong><ul><li>保存了一个 <code>List&lt;TicketNotificationSubscriber&gt;</code> 来记录所有注册过的观察者。</li><li><code>announceNewConcert(String concertName)</code> 用于触发通知动作，遍历列表，调用观察者的回调方法。</li><li><code>purchaseTicketFor(String concertName)</code> 只是演示“购买”流程，实际可接入更多业务逻辑。</li></ul></li><li><strong>Person (具体观察者 ConcreteObserver)</strong><ul><li>实现了 <code>TicketNotificationSubscriber</code> 接口，代表一个想要买演唱会票的人。</li><li>通过 <code>tryToBuyTicketsFor</code> 方法实现了“订阅”逻辑，把自己 (<code>this</code>) 注册给 <code>TicketSeller</code>。</li><li>当被通知 <code>ticketsAvailableFor</code> 时，会判断是不是自己真正感兴趣的演唱会，若是则立刻调用 <code>seller.purchaseTicketFor</code> 进行购买。</li></ul></li></ol><!--]--></div><div class="vp-tab" id="v-5" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">完整注释</div><!--[--><div class="language-java line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="java" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code class="language-java"><span class="line"><span style="color:#88846F;">// ======================</span></span>
<span class="line"><span style="color:#88846F;">// 文件名: ObserverPatternDemo.java</span></span>
<span class="line"><span style="color:#88846F;">// ======================</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F92672;"> java.util.ArrayList</span><span style="color:#F8F8F2;">; </span><span style="color:#88846F;">// 引入 ArrayList，用于保存订阅者列表</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F92672;"> java.util.List</span><span style="color:#F8F8F2;">;      </span><span style="color:#88846F;">// 引入 List 接口，用于抽象列表类型</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">/**</span></span>
<span class="line"><span style="color:#88846F;"> * 主类：包含 main 方法，是程序的入口</span></span>
<span class="line"><span style="color:#88846F;"> * 由于这个类是 public，所以文件名必须与类名相同（ObserverPatternDemo.java）</span></span>
<span class="line"><span style="color:#88846F;"> */</span></span>
<span class="line"><span style="color:#F92672;">public</span><span style="color:#F92672;"> class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">ObserverPatternDemo</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * main方法：Java 程序入口，执行演示逻辑</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#F92672;"> static</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> main</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#F8F8F2;">[] </span><span style="color:#FD971F;font-style:italic;">args</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#88846F;">        // 1. 创建主题（卖票方）</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">        TicketSeller</span><span style="color:#F8F8F2;"> ticketSeller </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> TicketSeller</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line"><span style="color:#88846F;">        // 这里我们实例化了一个 TicketSeller 对象，它将作为“事件发布者”（Subject）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">        // 2. 创建几个观察者</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">        Person</span><span style="color:#F8F8F2;"> alice </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Person</span><span style="color:#F8F8F2;">(); </span></span>
<span class="line"><span style="color:#88846F;">        // 实例化第一个观察者（对周杰伦感兴趣的用户）</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">        Person</span><span style="color:#F8F8F2;"> bob </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#A6E22E;"> Person</span><span style="color:#F8F8F2;">();   </span></span>
<span class="line"><span style="color:#88846F;">        // 实例化第二个观察者（对林俊杰感兴趣的用户）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">        // 3. 分别让 alice 和 bob 订阅自己感兴趣的演唱会</span></span>
<span class="line"><span style="color:#F8F8F2;">        alice.</span><span style="color:#A6E22E;">tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;周杰伦演唱会&quot;</span><span style="color:#F8F8F2;">, ticketSeller);</span></span>
<span class="line"><span style="color:#88846F;">        // alice 想要周杰伦演唱会门票，于是告诉 ticketSeller “我订阅这场演唱会”</span></span>
<span class="line"><span style="color:#F8F8F2;">        bob.</span><span style="color:#A6E22E;">tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;林俊杰演唱会&quot;</span><span style="color:#F8F8F2;">, ticketSeller);</span></span>
<span class="line"><span style="color:#88846F;">        // bob 想要林俊杰演唱会门票，也向 ticketSeller 订阅</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">        // 4. 卖票方宣布演唱会开始，看看谁会收到通知并且行动</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;</span><span style="color:#AE81FF;">\n</span><span style="color:#E6DB74;">=== 第一次宣布：周杰伦演唱会 ===&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        ticketSeller.</span><span style="color:#A6E22E;">announceNewConcert</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;周杰伦演唱会&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#88846F;">        // announceNewConcert 会通知所有已订阅的观察者</span></span>
<span class="line"><span style="color:#88846F;">        // alice 感兴趣，会执行购买；bob 也会收到通知但不感兴趣，所以不会购买</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;</span><span style="color:#AE81FF;">\n</span><span style="color:#E6DB74;">=== 第二次宣布：林俊杰演唱会 ===&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        ticketSeller.</span><span style="color:#A6E22E;">announceNewConcert</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;林俊杰演唱会&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#88846F;">        // 同理，这次 bob 会购买，alice 只会收到消息但不执行购买</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">/**</span></span>
<span class="line"><span style="color:#88846F;"> * 观察者接口：任何想收到“门票可用”通知的类，都必须实现此接口。</span></span>
<span class="line"><span style="color:#88846F;"> * 其中只有一个方法：ticketsAvailableFor(String concertName)</span></span>
<span class="line"><span style="color:#88846F;"> * 用于在某个演唱会可以购票时获得回调通知。</span></span>
<span class="line"><span style="color:#88846F;"> */</span></span>
<span class="line"><span style="color:#F92672;">interface</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 回调方法：当名为 concertName 的演唱会可购票时触发</span></span>
<span class="line"><span style="color:#88846F;">     * </span><span style="color:#F92672;">@param</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#88846F;"> 演唱会的名称</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">    void</span><span style="color:#A6E22E;"> ticketsAvailableFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">/**</span></span>
<span class="line"><span style="color:#88846F;"> * 主题(Subject)：卖票方 TicketSeller</span></span>
<span class="line"><span style="color:#88846F;"> * - 维护一个“订阅者”列表(subscribers)，</span></span>
<span class="line"><span style="color:#88846F;"> * - 当有新的演唱会消息时(announceNewConcert)，循环调用每个订阅者的回调方法。</span></span>
<span class="line"><span style="color:#88846F;"> */</span></span>
<span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">TicketSeller</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#88846F;">    // 用于存放所有已订阅的观察者(实现了 TicketNotificationSubscriber 接口的对象)</span></span>
<span class="line"><span style="color:#F92672;">    private</span><span style="color:#66D9EF;font-style:italic;"> List</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;">&gt; subscribers </span><span style="color:#F92672;">=</span><span style="color:#F92672;"> new</span><span style="color:#66D9EF;font-style:italic;"> ArrayList</span><span style="color:#F8F8F2;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 订阅方法：让任何实现了 TicketNotificationSubscriber 的对象加进来</span></span>
<span class="line"><span style="color:#88846F;">     * </span><span style="color:#F92672;">@param</span><span style="color:#FD971F;font-style:italic;"> subscriber</span><span style="color:#88846F;"> 传入的订阅者对象</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> signUpForNotifications</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#FD971F;font-style:italic;"> subscriber</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#FD971F;">        this</span><span style="color:#F8F8F2;">.subscribers.</span><span style="color:#A6E22E;">add</span><span style="color:#F8F8F2;">(subscriber);</span></span>
<span class="line"><span style="color:#88846F;">        // 将订阅者加入列表，以后有新演唱会时会通知他们</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 模拟宣布新的演唱会来临，并通知所有订阅者</span></span>
<span class="line"><span style="color:#88846F;">     * </span><span style="color:#F92672;">@param</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#88846F;"> 演唱会名字</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> announceNewConcert</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【TicketSeller】宣布演唱会 &quot;</span><span style="color:#F92672;"> +</span><span style="color:#F8F8F2;"> concertName </span><span style="color:#F92672;">+</span><span style="color:#E6DB74;"> &quot; 可以购票了！&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#88846F;">        // 广播给每一个订阅者</span></span>
<span class="line"><span style="color:#F92672;">        for</span><span style="color:#F8F8F2;"> (</span><span style="color:#66D9EF;font-style:italic;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> sub </span><span style="color:#F92672;">:</span><span style="color:#F8F8F2;"> subscribers) {</span></span>
<span class="line"><span style="color:#F8F8F2;">            sub.</span><span style="color:#A6E22E;">ticketsAvailableFor</span><span style="color:#F8F8F2;">(concertName);</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 简化的购票方法，这里仅做打印演示</span></span>
<span class="line"><span style="color:#88846F;">     * </span><span style="color:#F92672;">@param</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#88846F;"> 演唱会名字</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> purchaseTicketFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【TicketSeller】购买了演唱会 &quot;</span><span style="color:#F92672;"> +</span><span style="color:#F8F8F2;"> concertName </span><span style="color:#F92672;">+</span><span style="color:#E6DB74;"> &quot; 的门票。&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#88846F;">        // 实际业务中，可能会在这里进行扣款、票务记录、发送电子票等操作</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">/**</span></span>
<span class="line"><span style="color:#88846F;"> * 具体观察者(Concrete Observer)：一个“想买演唱会票的人”。</span></span>
<span class="line"><span style="color:#88846F;"> * 实现了 TicketNotificationSubscriber 接口，就可以订阅演唱会通知。</span></span>
<span class="line"><span style="color:#88846F;"> */</span></span>
<span class="line"><span style="color:#F92672;">class</span><span> </span><span style="color:#A6E22E;text-decoration:underline;">Person</span><span style="color:#F92672;"> implements</span><span> </span><span style="color:#A6E22E;font-style:italic;text-decoration:underline;">TicketNotificationSubscriber</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F92672;">    private</span><span style="color:#66D9EF;font-style:italic;"> String</span><span style="color:#F8F8F2;"> interestedConcert; </span><span style="color:#88846F;">// 保存感兴趣的演唱会名称</span></span>
<span class="line"><span style="color:#F92672;">    private</span><span style="color:#66D9EF;font-style:italic;"> TicketSeller</span><span style="color:#F8F8F2;"> seller;      </span><span style="color:#88846F;">// 用来操作买票、以及由谁发送通知</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 让这个人开始订阅并关注某个演唱会的门票通知</span></span>
<span class="line"><span style="color:#88846F;">     * </span><span style="color:#F92672;">@param</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#88846F;"> 感兴趣的演唱会名称</span></span>
<span class="line"><span style="color:#88846F;">     * </span><span style="color:#F92672;">@param</span><span style="color:#FD971F;font-style:italic;"> seller</span><span style="color:#88846F;"> 需要向哪个卖票方订阅</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> tryToBuyTicketsFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">, </span><span style="color:#66D9EF;font-style:italic;">TicketSeller</span><span style="color:#FD971F;font-style:italic;"> seller</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#FD971F;">        this</span><span style="color:#F8F8F2;">.interestedConcert </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> concertName; </span><span style="color:#88846F;">// 记录下自己想看的演唱会</span></span>
<span class="line"><span style="color:#FD971F;">        this</span><span style="color:#F8F8F2;">.seller </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> seller;                 </span><span style="color:#88846F;">// 记录要向哪个 TicketSeller 订阅</span></span>
<span class="line"><span style="color:#F8F8F2;">        seller.</span><span style="color:#A6E22E;">signUpForNotifications</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">);  </span><span style="color:#88846F;">// 将自己(this)注册到卖票方的订阅列表</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F;">    /**</span></span>
<span class="line"><span style="color:#88846F;">     * 收到票务通知的回调方法</span></span>
<span class="line"><span style="color:#88846F;">     * </span><span style="color:#F92672;">@param</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#88846F;"> 哪个演唱会来了票</span></span>
<span class="line"><span style="color:#88846F;">     */</span></span>
<span class="line"><span style="color:#F8F8F2;">    @</span><span style="color:#66D9EF;font-style:italic;">Override</span></span>
<span class="line"><span style="color:#F92672;">    public</span><span style="color:#66D9EF;font-style:italic;"> void</span><span style="color:#A6E22E;"> ticketsAvailableFor</span><span style="color:#F8F8F2;">(</span><span style="color:#66D9EF;font-style:italic;">String</span><span style="color:#FD971F;font-style:italic;"> concertName</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#88846F;">        // 每当 TicketSeller.broadcast 时，就会调用这个方法</span></span>
<span class="line"><span style="color:#F8F8F2;">        System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【Person】收到通知：演唱会 &quot;</span><span style="color:#F92672;"> +</span><span style="color:#F8F8F2;"> concertName </span><span style="color:#F92672;">+</span><span style="color:#E6DB74;"> &quot; 票来了！&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#88846F;">        // 如果和自己的 interestedConcert 匹配，才去买</span></span>
<span class="line"><span style="color:#F92672;">        if</span><span style="color:#F8F8F2;"> (concertName.</span><span style="color:#A6E22E;">equals</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;">this</span><span style="color:#F8F8F2;">.interestedConcert)) {</span></span>
<span class="line"><span style="color:#F8F8F2;">            System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【Person】正是我想看的演唱会！赶紧买票！&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">            seller.</span><span style="color:#A6E22E;">purchaseTicketFor</span><span style="color:#F8F8F2;">(concertName);</span></span>
<span class="line"><span style="color:#F8F8F2;">        } </span><span style="color:#F92672;">else</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">            System.out.</span><span style="color:#A6E22E;">println</span><span style="color:#F8F8F2;">(</span><span style="color:#E6DB74;">&quot;【Person】但这场演唱会我不感兴趣。&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p></p><!--]--></div><!--]--></div><h2 id="_4-扩展与思考" tabindex="-1"><a class="header-anchor" href="#_4-扩展与思考"><span>4. 扩展与思考</span></a></h2><p>上面是最简洁的一种实现方式。在实际项目中，根据需求不同，还可能会有一些变体或增强：</p><ol><li><strong>增加取消订阅（unregister / removeObserver）</strong>：有时观察者不再对某些事件感兴趣，需要在主题中把自己移除。</li><li><strong>增加多种通知类型</strong>：比如不仅仅是“演唱会开始发售”这一种事件，可能还有“演唱会售罄”之类的事件，此时观察者接口里可以有多个方法。</li><li><strong>过滤特定主题</strong>：如讲义中提到的，如果观众只想听一个歌手或者只想了解某些演出，就可以让 <code>TicketSeller</code> 更智能地发送更“精准”的通知。</li><li><strong>批量通知</strong>：有时不想一有消息就通知，可以几个小时发送一次“综合”消息，比如常见的邮件订阅选项“立即通知”VS“每日/每周汇总”。</li></ol><p>无论如何，核心点不变：<strong>主题维护一组观察者对象，发生某件事时调用观察者接口的方法进行回调，从而让观察者对该事件做出相应处理。</strong> 这就是观察者模式(Observer Pattern)。</p><h2 id="_5-小结" tabindex="-1"><a class="header-anchor" href="#_5-小结"><span>5. 小结</span></a></h2><ul><li><strong>问题场景</strong>：当某个对象发生“某种变化”时，需要通知其他感兴趣的对象。</li><li>核心结构： <ul><li>主题(Subject)保存一个观察者(Observer)列表；</li><li>主题发生事件时，依次调用<code>observer.回调方法()</code>去通知。</li></ul></li><li><strong>适用范围非常广</strong>：图形界面的按钮点击、网络状态变更的通知、订阅-发布系统等都可归为观察者模式。</li></ul><p>希望这个例子和逐步实现的过程能帮你真正理解并掌握“观察者模式”。如果你把上面的代码都放在一个文件里（或者按照各个类拆成多个文件），编译运行，就可以亲眼看到程序如何在“广播事件”时通知所有观察者了。</p><details class="hint-container details"><summary>公众号：AI悦创【二维码】</summary><figure><img src="/gzh.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></details><div class="hint-container info"><p class="hint-container-title">AI悦创·编程一对一</p><p>AI悦创·推出辅导班啦，包括「Python 语言辅导班、C++ 辅导班、java 辅导班、算法/数据结构辅导班、少儿编程、pygame 游戏开发、Web、Linux」，全部都是一对一教学：一对一辅导 + 一对一答疑 + 布置作业 + 项目实践等。当然，还有线下线上摄影课程、Photoshop、Premiere 一对一教学、QQ、微信在线，随时响应！微信：Jiabcdefh</p><p>C++ 信息奥赛题解，长期更新！长期招收一对一中小学信息奥赛集训，莆田、厦门地区有机会线下上门，其他地区线上。微信：Jiabcdefh</p><p>方法一：<a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1432803776&amp;site=qq&amp;menu=yes" target="_blank" rel="noopener noreferrer">QQ</a></p><p>方法二：微信：Jiabcdefh</p></div><figure><img src="/zsxq.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></div><!----><!----><!----></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">最近更新</span><time class="vp-meta-info" datetime="2025-07-04T03:57:54.000Z" data-allow-mismatch>2025/7/4 03:57</time></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: bornforthis@bornforthis.cn">AndersonHJB</span><!--]--><!--]--></div></div></footer><!----><div id="comment" class="waline-wrapper vp-comment" vp-comment darkmode="false" style="display:block;"><!----></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">Copyright © 2018-2024 长期招收编程一对一学员!微信:Jiabcdefh</div><div class="vp-copyright">Copyright © 2025 AI悦创 </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BgxfbuhL.js" defer></script>
  </body>
</html>
