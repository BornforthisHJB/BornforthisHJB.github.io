import{_ as n}from"./gzh-DnOBNg6W.js";import{_ as a}from"./zsxq-BcdwOI-_.js";import{_ as l}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as p,a as e,o}from"./app-Dw1plHhF.js";const F="/assets/image-20220715211758604-DoLRTH1D.png",t="/assets/image-20220715221653761-B1tFnwyQ.png",c="/assets/image-20220715222043587-DIEK904i.png",r="/assets/image-20220715222746640-iObMCpqs.png",i={};function y(d,s){return o(),p("div",null,s[0]||(s[0]=[e('<h2 id="实例需求说明" tabindex="-1"><a class="header-anchor" href="#实例需求说明"><span>实例需求说明</span></a></h2><p>学习了 Excel 文件的写入、读取和追加内容，那现在来做个案例。</p><p>需求描述并整理，如下：</p><ul><li>每个月的 2 号，你会收到一个 Excel 文件；</li><li>文件中包含了 各个部门的员工信息；</li><li>你需要一天之内完成这些报表的整理和统计，然后交给领导检查和发放工资；</li><li>时间要快，工资发晚了，同事会抱怨你；</li><li>工作量还是比较大的，你需要解放双手，让程序去处理问题</li><li>让程序快速的计算出每个人的工资，并将统计信息结合模板，生成“<code>xxxx年xx月各部门员工数据总览</code>”；</li><li>薪资计算规定：迟到一次扣 20，一个月最多扣 200；</li></ul><p>简单的财务自动化结算需求，并且给出了各部门的工资表格文件和统计报表的模板文件。</p><h2 id="需求说明图示" tabindex="-1"><a class="header-anchor" href="#需求说明图示"><span>需求说明图示</span></a></h2><p>简单的财务自动化结算需求，并且给出了各部门的工资表格文件和统计报表的模板文件，截图如下：</p><figure><img src="'+F+`" alt="image-20220715211758604" tabindex="0" loading="lazy"><figcaption>image-20220715211758604</figcaption></figure><p>“<code>批量生成财务报表.ipynb</code>”这个文件里面有可执行代码，执行后会自动的生成 5 个部门的财务文件。你也可以自己使用下面代码自动生成：</p><div class="language-python line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="python" data-title="python" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#88846F;"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#88846F;"># @Time    : 2022/7/15 21:48</span></span>
<span class="line"><span style="color:#88846F;"># @Author  : AI悦创</span></span>
<span class="line"><span style="color:#88846F;"># @FileName: demo2.py</span></span>
<span class="line"><span style="color:#88846F;"># @Software: PyCharm</span></span>
<span class="line"><span style="color:#88846F;"># @Blog    ：http://www.aiyc.top</span></span>
<span class="line"><span style="color:#88846F;"># @公众号   ：AI悦创</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> xlwt</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> faker</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> random</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> datetime</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">def</span><span style="color:#A6E22E;"> create_excel_file</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">filename</span><span style="color:#F8F8F2;">, </span><span style="color:#FD971F;font-style:italic;">department</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">    wb </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> xlwt.Workbook(filename)</span></span>
<span class="line"><span style="color:#F8F8F2;">    sheet </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb.add_sheet(</span><span style="color:#E6DB74;">&#39;sheet1&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    fake </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> faker.Faker(</span><span style="color:#E6DB74;">&quot;zh_CN&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    head_data </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> [</span><span style="color:#E6DB74;">&#39;部门&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;姓名&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;工号&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;薪资（元）&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;迟到次数（次）&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;奖金（元）&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;实发工资&#39;</span><span style="color:#F8F8F2;">]</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> head </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> head_data:</span></span>
<span class="line"><span style="color:#F8F8F2;">        sheet.write(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, head_data.index(head), head)</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> i </span><span style="color:#F92672;">in</span><span style="color:#66D9EF;"> range</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, random.randint(</span><span style="color:#AE81FF;">5</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">100</span><span style="color:#F8F8F2;">)):</span></span>
<span class="line"><span style="color:#F8F8F2;">        sheet.write(i, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, department)</span></span>
<span class="line"><span style="color:#F8F8F2;">        sheet.write(i, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, fake.last_name() </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> fake.first_name())</span></span>
<span class="line"><span style="color:#F8F8F2;">        sheet.write(i, </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&quot;G</span><span style="color:#AE81FF;">{}</span><span style="color:#E6DB74;">&quot;</span><span style="color:#F8F8F2;">.format(random.randint(</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1000</span><span style="color:#F8F8F2;">)))</span></span>
<span class="line"><span style="color:#F8F8F2;">        sheet.write(i, </span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;">, random.randint(</span><span style="color:#AE81FF;">4000</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">16000</span><span style="color:#F8F8F2;">))</span></span>
<span class="line"><span style="color:#F8F8F2;">        sheet.write(i, </span><span style="color:#AE81FF;">4</span><span style="color:#F8F8F2;">, random.choice([</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">4</span><span style="color:#F8F8F2;">]))</span></span>
<span class="line"><span style="color:#F8F8F2;">        sheet.write(i, </span><span style="color:#AE81FF;">5</span><span style="color:#F8F8F2;">, random.choice([</span><span style="color:#AE81FF;">200</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">300</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">400</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">500</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">600</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">700</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">800</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">900</span><span style="color:#F8F8F2;">]))</span></span>
<span class="line"><span style="color:#F8F8F2;">    wb.save(filename)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">department_name </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> [</span><span style="color:#E6DB74;">&#39;技术部&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;推广部&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;客服部&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;行政部&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;财务部&#39;</span><span style="color:#F8F8F2;">]</span></span>
<span class="line"><span style="color:#F92672;">for</span><span style="color:#F8F8F2;"> dep </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> department_name:</span></span>
<span class="line"><span style="color:#F8F8F2;">    xls_name </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;</span><span style="color:#AE81FF;">{}</span><span style="color:#E6DB74;">-</span><span style="color:#AE81FF;">{}</span><span style="color:#E6DB74;">.xls&quot;</span><span style="color:#F8F8F2;">.format(datetime.datetime.now().strftime(</span><span style="color:#E6DB74;">&quot;%Y-%m&quot;</span><span style="color:#F8F8F2;">), dep)</span></span>
<span class="line"><span style="color:#F8F8F2;">    create_excel_file(xls_name, dep)</span></span>
<span class="line"><span style="color:#66D9EF;">    print</span><span style="color:#F8F8F2;">(xls_name, </span><span style="color:#E6DB74;">&quot; 新建完成&quot;</span><span style="color:#F8F8F2;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>下面是财务文件和模板文件的截图：</p><figure><img src="`+t+'" alt="image-20220715221653761" tabindex="0" loading="lazy"><figcaption>image-20220715221653761</figcaption></figure><figure><img src="'+c+'" alt="image-20220715222043587" tabindex="0" loading="lazy"><figcaption>image-20220715222043587</figcaption></figure><p>财务文件中，每个用户数据，都是缺少应发工资的，需要用程序计算和填写；</p><p>模板文件的使用，需要将本月的部门财务文件全部计算并统计出来，然后填充到模板文件中，生成一个本月的数据总览表格，如下截图：</p><figure><img src="'+r+`" alt="image-20220715222746640" tabindex="0" loading="lazy"><figcaption>image-20220715222746640</figcaption></figure><p>选中的部分是需要使用程序自动填写。</p><p>一共有5个财务文件，每个文件有不固定个数的员工信息。</p><p>那接下来就开始写代码，实现自动化工资结算和统计报表的任务。</p><h2 id="库的导入和准备代码" tabindex="-1"><a class="header-anchor" href="#库的导入和准备代码"><span>库的导入和准备代码</span></a></h2><p>首先第一步，导入需要的库，生成时间对象。还有就是文件夹中，放着很多文件，有 <code>xls</code>、<code>ipynb</code> 等格式，所以还需指定要操作的文件名，如下代码：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> datetime</span></span>
<span class="line"><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> xlrd, xlwt</span></span>
<span class="line"><span style="color:#F92672;">from</span><span style="color:#F8F8F2;"> xlutils.copy </span><span style="color:#F92672;">import</span><span style="color:#F8F8F2;"> copy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">department </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> [</span><span style="color:#E6DB74;">&#39;技术部&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;推广部&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;客服部&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;行政部&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#E6DB74;">&#39;财务部&#39;</span><span style="color:#F8F8F2;">]</span></span>
<span class="line"><span style="color:#F8F8F2;">template_name </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;月结统计模板.xls&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">today_datetime </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> datetime.datetime.now()</span></span>
<span class="line"><span style="color:#F8F8F2;">need_process_xls </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> []</span></span>
<span class="line"><span style="color:#F92672;">for</span><span style="color:#F8F8F2;"> dep </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> department:</span></span>
<span class="line"><span style="color:#F8F8F2;">    xls_name </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;</span><span style="color:#AE81FF;">{}</span><span style="color:#E6DB74;">-</span><span style="color:#AE81FF;">{}</span><span style="color:#E6DB74;">.xls&quot;</span><span style="color:#F8F8F2;">.format(datetime.datetime.now().strftime(</span><span style="color:#E6DB74;">&quot;%Y-%m&quot;</span><span style="color:#F8F8F2;">), dep)</span></span>
<span class="line"><span style="color:#F8F8F2;">    need_process_xls.append(xls_name)</span></span>
<span class="line"><span style="color:#66D9EF;">print</span><span style="color:#F8F8F2;">(need_process_xls)</span></span>
<span class="line"><span style="color:#88846F;"># 输出：[&#39;2022-12-技术部.xls&#39;, &#39;2022-12-推广部.xls&#39;, &#39;2022-12-客服部.xls&#39;, &#39;2022-12-行政部.xls&#39;, &#39;2022-12-财务部.xls&#39;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里指定了模板文件名，时间对象，然后批量的生成了所需处理的部门财务文件。</p><h2 id="python-自动化结算工资" tabindex="-1"><a class="header-anchor" href="#python-自动化结算工资"><span>Python 自动化结算工资</span></a></h2><p>每个财务文件都是完全一致的，就是数据的不同，所以接下来，做一个函数，所做的操作就是接收文件名，并计算出文件中全部人员的工资，并写入文件然后保存。代码如下：</p><div class="language-python line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="python" data-title="python" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">def</span><span style="color:#A6E22E;"> process_xls_return_data</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">xls_name</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">    wb </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> xlrd.open_workbook(xls_name)</span></span>
<span class="line"><span style="color:#F8F8F2;">    wb_sheet </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb.sheet_by_index(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    xwb </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> copy(wb)</span></span>
<span class="line"><span style="color:#F8F8F2;">    xwb_sheet </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> xwb.get_sheet(</span><span style="color:#E6DB74;">&#39;sheet1&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    rows </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.nrows</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> row </span><span style="color:#F92672;">in</span><span style="color:#66D9EF;"> range</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, rows):</span></span>
<span class="line"><span style="color:#F8F8F2;">        bm </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F8F8F2;">        xm </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F8F8F2;">        gh </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F8F8F2;">        gz </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F8F8F2;">        cdcs </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">4</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F8F8F2;">        jj </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">5</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F8F8F2;">        sfgz </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> gz </span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;"> (cdcs </span><span style="color:#F92672;">*</span><span style="color:#AE81FF;"> 20</span><span style="color:#F8F8F2;">) </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> jj  </span><span style="color:#88846F;"># 实发工资 = 工资  -  （迟到次数*20）  +  奖金</span></span>
<span class="line"><span style="color:#66D9EF;">        print</span><span style="color:#F8F8F2;">(bm, xm, gh, gz, cdcs, jj, sfgz)</span></span>
<span class="line"><span style="color:#F8F8F2;">        xwb_sheet.write(row, </span><span style="color:#AE81FF;">6</span><span style="color:#F8F8F2;">, sfgz)</span></span>
<span class="line"><span style="color:#F8F8F2;">        xwb.save(xls_name)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">for</span><span style="color:#FD971F;"> cls</span><span style="color:#F92672;"> in</span><span style="color:#F8F8F2;"> need_process_xls:</span></span>
<span class="line"><span style="color:#F8F8F2;">    process_xls_return_data(</span><span style="color:#FD971F;">cls</span><span style="color:#F8F8F2;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>对函数代码进行介绍：</p><ul><li>打开文件，打开 sheet，复制文件，读取文件中数据的总行数；</li><li>从第二行【索引1】开始，读取 部门、姓名、工号、工资、迟到次数、奖金；</li><li>然后计算应发工资，公式：应该工资 = 工资 - （迟到次数*20） + 奖金；</li><li>将应该工资写入到当前行的第7个位置【索引6】上；</li><li>最后保存，保存的文件名依旧是源文件名；</li><li>完成单个文件的操作；</li></ul><p>最下面的 for 循环，就是循环读取要操作的全部财务文件，逐个进入函数中操作，计算工资和保存。</p><h2 id="python-自动化结算工资-报表统计" tabindex="-1"><a class="header-anchor" href="#python-自动化结算工资-报表统计"><span>Python 自动化结算工资+报表统计</span></a></h2><p>自动化的工资结算已经处理好了，下面就是统计各个部门的财务报表。</p><p>报表中，需要写入 部门、总人数、迟到人数、拿奖金人数、应发总工资这五项，还有头部的“<code>xxxx-xx-各部门员工数据总览</code>”</p><p>部门的数据，都是从单个的部门财务文件中获取，例如迟到人数和拿奖金人数，都是判断是否迟到和是否有奖金，都用一个参数进行记录。</p><p>这个需求，可以在原来的函数之上，做个统计操作，并在函数结尾时，将这五个数据，做成列表并返回回去。</p><p>最后一个就是统计报表的头部字段，里面含有年份和月份，这个可以直接使用时间对象生成即可，但是字体的大小和居中效果是需要额外定义样式 style 的，所以这部分代码比较突兀，大家看懂即可。</p><p>如下代码：</p><div class="language-python line-numbers-mode has-collapsed-lines collapsed" data-highlighter="shiki" data-ext="python" data-title="python" style="--vp-collapsed-lines:15;background-color:#272822;color:#F8F8F2;"><pre class="shiki monokai vp-code"><code><span class="line"><span style="color:#66D9EF;font-style:italic;">def</span><span style="color:#A6E22E;"> process_xls_return_data</span><span style="color:#F8F8F2;">(</span><span style="color:#FD971F;font-style:italic;">xls_name</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">    staff_number </span><span style="color:#F92672;">=</span><span style="color:#AE81FF;"> 0</span><span style="color:#88846F;">  # 总人数字段</span></span>
<span class="line"><span style="color:#F8F8F2;">    cd_number </span><span style="color:#F92672;">=</span><span style="color:#AE81FF;"> 0</span><span style="color:#88846F;">  # 迟到人数字段</span></span>
<span class="line"><span style="color:#F8F8F2;">    jj_number </span><span style="color:#F92672;">=</span><span style="color:#AE81FF;"> 0</span><span style="color:#88846F;">  # 拿奖金人数字段</span></span>
<span class="line"><span style="color:#F8F8F2;">    total_pay </span><span style="color:#F92672;">=</span><span style="color:#AE81FF;"> 0</span><span style="color:#88846F;">  # 总应发工资字段</span></span>
<span class="line"><span style="color:#F8F8F2;">    wb </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> xlrd.open_workbook(xls_name, </span><span style="color:#FD971F;font-style:italic;">formatting_info</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">True</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    wb_sheet </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb.sheet_by_index(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    xwb </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> copy(wb)</span></span>
<span class="line"><span style="color:#F8F8F2;">    xwb_sheet </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> xwb.get_sheet(</span><span style="color:#E6DB74;">&#39;sheet1&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    rows </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.nrows</span></span>
<span class="line"><span style="color:#F92672;">    for</span><span style="color:#F8F8F2;"> row </span><span style="color:#F92672;">in</span><span style="color:#66D9EF;"> range</span><span style="color:#F8F8F2;">(</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, rows):</span></span>
<span class="line"><span style="color:#F8F8F2;">        staff_number </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> staff_number </span><span style="color:#F92672;">+</span><span style="color:#AE81FF;"> 1</span><span style="color:#88846F;">  # 每个数据都是一个员工，直接+1</span></span>
<span class="line"><span style="color:#F8F8F2;">        bm </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">).value  </span><span style="color:#88846F;"># 部门名称</span></span>
<span class="line"><span style="color:#F8F8F2;">        xm </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F8F8F2;">        gh </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F8F8F2;">        gz </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F8F8F2;">        cdcs </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">4</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F92672;">        if</span><span style="color:#F8F8F2;"> cdcs </span><span style="color:#F92672;">&gt;</span><span style="color:#AE81FF;"> 0</span><span style="color:#F8F8F2;">:  </span><span style="color:#88846F;"># 如果迟到次数大于0，则是迟到过的人，迟到人数+1</span></span>
<span class="line"><span style="color:#F8F8F2;">            cd_number </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> cd_number </span><span style="color:#F92672;">+</span><span style="color:#AE81FF;"> 1</span></span>
<span class="line"><span style="color:#F8F8F2;">        jj </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.cell(row, </span><span style="color:#AE81FF;">5</span><span style="color:#F8F8F2;">).value</span></span>
<span class="line"><span style="color:#F92672;">        if</span><span style="color:#F8F8F2;"> jj </span><span style="color:#F92672;">&gt;</span><span style="color:#AE81FF;"> 0</span><span style="color:#F8F8F2;">:  </span><span style="color:#88846F;"># 如果奖金大于0，则是获得了奖金的人，拿奖金人数+1</span></span>
<span class="line"><span style="color:#F8F8F2;">            jj_number </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> jj_number </span><span style="color:#F92672;">+</span><span style="color:#AE81FF;"> 1</span></span>
<span class="line"><span style="color:#F8F8F2;">        sfgz </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> gz </span><span style="color:#F92672;">-</span><span style="color:#F8F8F2;"> (cdcs </span><span style="color:#F92672;">*</span><span style="color:#AE81FF;"> 20</span><span style="color:#F8F8F2;">) </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> jj  </span><span style="color:#88846F;"># 实发工资 = 工资  -  （迟到次数*20）  +  奖金</span></span>
<span class="line"><span style="color:#F8F8F2;">        total_pay </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> total_pay </span><span style="color:#F92672;">+</span><span style="color:#F8F8F2;"> sfgz  </span><span style="color:#88846F;"># 将所有的实发工资加到一起，就是总的实发工资</span></span>
<span class="line"><span style="color:#66D9EF;">        print</span><span style="color:#F8F8F2;">(bm, xm, gh, gz, cdcs, jj, sfgz)</span></span>
<span class="line"><span style="color:#F8F8F2;">        xwb_sheet.write(row, </span><span style="color:#AE81FF;">6</span><span style="color:#F8F8F2;">, sfgz)</span></span>
<span class="line"><span style="color:#F8F8F2;">    xwb.save(xls_name)</span></span>
<span class="line"><span style="color:#66D9EF;">    print</span><span style="color:#F8F8F2;">([bm, staff_number, cd_number, jj_number, total_pay])</span></span>
<span class="line"><span style="color:#F92672;">    return</span><span style="color:#F8F8F2;"> [bm, staff_number, cd_number, jj_number, total_pay]  </span><span style="color:#88846F;"># 最后将部门 总人数  总迟到人数  总拿奖金人数  总实发工资做成列表，一并返回</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">all_info </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> []</span></span>
<span class="line"><span style="color:#F92672;">for</span><span style="color:#FD971F;"> cls</span><span style="color:#F92672;"> in</span><span style="color:#F8F8F2;"> need_process_xls:</span></span>
<span class="line"><span style="color:#F8F8F2;">    one_partment </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> process_xls_return_data(</span><span style="color:#FD971F;">cls</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    all_info.append(one_partment)  </span><span style="color:#88846F;"># 将函数的返回值，放到列表中，就得到了所有部门的统计信息</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">wb </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> xlrd.open_workbook(template_name, </span><span style="color:#FD971F;font-style:italic;">formatting_info</span><span style="color:#F92672;">=</span><span style="color:#AE81FF;">True</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">wb_sheet </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb.sheet_by_index(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">xwb </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> copy(wb)</span></span>
<span class="line"><span style="color:#F8F8F2;">xwb_sheet </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> xwb.get_sheet(</span><span style="color:#E6DB74;">&#39;Sheet1&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">current_row </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> wb_sheet.nrows</span></span>
<span class="line"><span style="color:#F8F8F2;">year_month </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> datetime.datetime.now().strftime(</span><span style="color:#E6DB74;">&quot;%Y-%m&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">title </span><span style="color:#F92672;">=</span><span style="color:#E6DB74;"> &quot;</span><span style="color:#AE81FF;">{}</span><span style="color:#E6DB74;">-各部门员工数据总览&quot;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic;">def</span><span style="color:#A6E22E;"> create_style</span><span style="color:#F8F8F2;">():  </span><span style="color:#88846F;"># 定义字体格式，返回一个字体大小24，垂直居中 水平居中 宋体格式 的样式</span></span>
<span class="line"><span style="color:#F8F8F2;">    style </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> xlwt.XFStyle()</span></span>
<span class="line"><span style="color:#F8F8F2;">    fnt </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> xlwt.Font()  </span><span style="color:#88846F;"># 创建一个文本格式，包括字体、字号和颜色样式特性</span></span>
<span class="line"><span style="color:#F8F8F2;">    fnt.name </span><span style="color:#F92672;">=</span><span style="color:#66D9EF;font-style:italic;"> u</span><span style="color:#E6DB74;">&#39;宋体&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    fnt.height </span><span style="color:#F92672;">=</span><span style="color:#AE81FF;"> 20</span><span style="color:#F92672;"> *</span><span style="color:#AE81FF;"> 24</span></span>
<span class="line"><span style="color:#F8F8F2;">    alignment </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> xlwt.Alignment()</span></span>
<span class="line"><span style="color:#F8F8F2;">    alignment.horz </span><span style="color:#F92672;">=</span><span style="color:#66D9EF;font-style:italic;"> 0x</span><span style="color:#AE81FF;">02</span><span style="color:#88846F;">  # 0x01(左端对齐)、0x02(水平方向上居中对齐)、0x03(右端对齐)</span></span>
<span class="line"><span style="color:#F8F8F2;">    alignment.vert </span><span style="color:#F92672;">=</span><span style="color:#66D9EF;font-style:italic;"> 0x</span><span style="color:#AE81FF;">01</span><span style="color:#88846F;">  # 0x00(上端对齐)、 0x01(垂直方向上居中对齐)、0x02(底端对齐)</span></span>
<span class="line"><span style="color:#F8F8F2;">    style.font </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> fnt</span></span>
<span class="line"><span style="color:#F8F8F2;">    style.alignment </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> alignment</span></span>
<span class="line"><span style="color:#F92672;">    return</span><span style="color:#F8F8F2;"> style</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">xwb_sheet.write(</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, title.format(year_month), create_style())  </span><span style="color:#88846F;"># 写入头部标题，内容是“xxxx-xx-各部门员工数据总览”，样式是 宋体 大小24 垂直水平居中</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672;">for</span><span style="color:#F8F8F2;"> info </span><span style="color:#F92672;">in</span><span style="color:#F8F8F2;"> all_info:  </span><span style="color:#88846F;"># 循环所有的部门信息，全部写入到文件中</span></span>
<span class="line"><span style="color:#F8F8F2;">    xwb_sheet.write(current_row, </span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">, info[</span><span style="color:#AE81FF;">0</span><span style="color:#F8F8F2;">])</span></span>
<span class="line"><span style="color:#F8F8F2;">    xwb_sheet.write(current_row, </span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">, info[</span><span style="color:#AE81FF;">1</span><span style="color:#F8F8F2;">])</span></span>
<span class="line"><span style="color:#F8F8F2;">    xwb_sheet.write(current_row, </span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">, info[</span><span style="color:#AE81FF;">2</span><span style="color:#F8F8F2;">])</span></span>
<span class="line"><span style="color:#F8F8F2;">    xwb_sheet.write(current_row, </span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;">, info[</span><span style="color:#AE81FF;">3</span><span style="color:#F8F8F2;">])</span></span>
<span class="line"><span style="color:#F8F8F2;">    xwb_sheet.write(current_row, </span><span style="color:#AE81FF;">4</span><span style="color:#F8F8F2;">, info[</span><span style="color:#AE81FF;">4</span><span style="color:#F8F8F2;">])</span></span>
<span class="line"><span style="color:#F8F8F2;">    current_row </span><span style="color:#F92672;">=</span><span style="color:#F8F8F2;"> current_row </span><span style="color:#F92672;">+</span><span style="color:#AE81FF;"> 1</span></span>
<span class="line"><span style="color:#F8F8F2;">xwb.save(title.format(year_month) </span><span style="color:#F92672;">+</span><span style="color:#E6DB74;"> &#39;.xls&#39;</span><span style="color:#F8F8F2;">)  </span><span style="color:#88846F;"># 最后保存，文件名是 xxxx-xx-各部门员工数据总览.xls</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="collapsed-lines"></div></div><p>这个代码是基于上一个函数代码的，多了部门信息统计和基于模板文件生成”<code>xxxx-xx-各部门员工数据总览.xls</code>“的统计文件</p><p>以上就是本次任务的实现过程。结合代码块1和代码块3，就是完整的代码块。</p><p>源码中有文中的全部代码文件，包含“<code>批量生成财务报表.ipynb</code>”的代码文件，可以自动生成任意多个部门和任意多个员工的财务文件。</p><p>欢迎关注我公众号：AI悦创，有更多更好玩的等你发现！</p><details class="hint-container details"><summary>公众号：AI悦创【二维码】</summary><figure><img src="`+n+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></details><div class="hint-container info"><p class="hint-container-title">AI悦创·编程一对一</p><p>AI悦创·推出辅导班啦，包括「Python 语言辅导班、C++ 辅导班、java 辅导班、算法/数据结构辅导班、少儿编程、pygame 游戏开发」，全部都是一对一教学：一对一辅导 + 一对一答疑 + 布置作业 + 项目实践等。当然，还有线下线上摄影课程、Photoshop、Premiere 一对一教学、QQ、微信在线，随时响应！微信：Jiabcdefh</p><p>C++ 信息奥赛题解，长期更新！长期招收一对一中小学信息奥赛集训，莆田、厦门地区有机会线下上门，其他地区线上。微信：Jiabcdefh</p><p>方法一：<a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1432803776&amp;site=qq&amp;menu=yes" target="_blank" rel="noopener noreferrer">QQ</a></p><p>方法二：微信：Jiabcdefh</p></div><figure><img src="'+a+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',44)]))}const h=l(i,[["render",y],["__file","auto_base07.html.vue"]]),_=JSON.parse('{"path":"/Python/pyauto/auto_base07.html","title":"07-Python自动化结算工资和统计报表","lang":"zh-CN","frontmatter":{"title":"07-Python自动化结算工资和统计报表","date":"2022-07-15T20:34:58.000Z","author":"AI悦创","isOriginal":true,"category":"Python 办公自动化","tag":["Python 办公自动化"],"icon":"python","sticky":false,"star":false,"article":true,"timeline":true,"image":false,"navbar":true,"sidebarIcon":true,"headerDepth":5,"comment":true,"lastUpdated":true,"editLink":true,"prev":"auto_base06.md","next":"auto_base08.md","backToTop":true,"toc":true,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"实例需求说明","slug":"实例需求说明","link":"#实例需求说明","children":[]},{"level":2,"title":"需求说明图示","slug":"需求说明图示","link":"#需求说明图示","children":[]},{"level":2,"title":"库的导入和准备代码","slug":"库的导入和准备代码","link":"#库的导入和准备代码","children":[]},{"level":2,"title":"Python 自动化结算工资","slug":"python-自动化结算工资","link":"#python-自动化结算工资","children":[]},{"level":2,"title":"Python 自动化结算工资+报表统计","slug":"python-自动化结算工资-报表统计","link":"#python-自动化结算工资-报表统计","children":[]}],"git":{"createdTime":1706497934000,"updatedTime":1706497934000,"contributors":[{"name":"AndersonHJB","email":"cleland1432803776@icloud.com","commits":1}]},"readingTime":{"minutes":8.19,"words":2456},"filePathRelative":"Python/pyauto/auto_base07.md","localizedDate":"2022年7月15日","copyright":{"author":"AI悦创"}}');export{h as comp,_ as data};
