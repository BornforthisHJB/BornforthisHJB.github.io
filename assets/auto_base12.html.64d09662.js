import{_ as e}from"./gzh.b03adfd2.js";import{_ as t}from"./zsxq.77f6dc86.js";import{_ as p}from"./_plugin-vue_export-helper.cdc0426e.js";import{o,c,a as n,d as s,b as l,e as i,r as u}from"./app.18aa522a.js";const r="/assets/201912101035209680.86569100.png",d={},k=i(`<h2 id="需求说明" tabindex="-1"><a class="header-anchor" href="#需求说明" aria-hidden="true">#</a> 需求说明</h2><p>你好，我是悦创。</p><p>xlsxwriter 只能创建新的文件，不能对文件进行数据的追加和读取操作。</p><p>需要追加和读取 xlsx 文件，就需要用到 openpyxl 这个库了。安装命令：<code>pip install openpyxl</code>。</p><div class="language-cmd line-numbers-mode" data-ext="cmd"><pre class="language-cmd"><code>pip install openpyxl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用 openpyxl 完成这面这个需求：</p><ul><li>读取上面创建好的 <code>xlsxwriter插入数据和折线图.xlsx</code> 文件，复制一份，保存到 poenpyxl 插入数据和折线图[copy xlsxwriter].xlsx复制的文件中</li><li>sheet1 保持和源文件的 sheet1 一致，折线图不画复制的文件中</li><li>创建一个 sheet2，sheet2 的数据从 sheet1 中拷贝过来</li><li>随机的增加 1 年的随机数据，也就是 2020 年 1 月至 12 月的日期，数据1和数据2的12个数据随机生成</li><li>在sheet2中画一个折线图，统计数据1和数据2</li></ul><p>需求有四个，有难有易。</p><h2 id="拷贝文件" tabindex="-1"><a class="header-anchor" href="#拷贝文件" aria-hidden="true">#</a> 拷贝文件</h2><h3 id="第一个是拷贝文件和-sheet1" tabindex="-1"><a class="header-anchor" href="#第一个是拷贝文件和-sheet1" aria-hidden="true">#</a> 第一个是拷贝文件和 sheet1</h3><p>其实拷贝了文件，自然就包含 sheet1，最简单了，如下代码：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> openpyxl
filename <span class="token operator">=</span> <span class="token string">&#39;xlsxwriter插入数据和折线图.xlsx&#39;</span>
wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">&#39;poenpyxl插入数据和折线图[copy xlsxwriter].xlsx&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样就得到了源文件和 sheet1 的复制品。</p><h2 id="拷贝-sheet-内容" tabindex="-1"><a class="header-anchor" href="#拷贝-sheet-内容" aria-hidden="true">#</a> 拷贝 sheet 内容</h2><h3 id="第二个需求-拷贝-sheet1-做成-sheet2" tabindex="-1"><a class="header-anchor" href="#第二个需求-拷贝-sheet1-做成-sheet2" aria-hidden="true">#</a> 第二个需求，拷贝 sheet1，做成 sheet2</h3><p>也简单，如下代码：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> openpyxl
filename <span class="token operator">=</span> <span class="token string">&#39;xlsxwriter插入数据和折线图.xlsx&#39;</span>
wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

sheet1 <span class="token operator">=</span> wb<span class="token punctuation">[</span><span class="token string">&#39;sheet1&#39;</span><span class="token punctuation">]</span>
sheet2 <span class="token operator">=</span> wb<span class="token punctuation">.</span>copy_worksheet<span class="token punctuation">(</span>sheet1<span class="token punctuation">)</span>
sheet2<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;sheet2&quot;</span>

wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">&#39;poenpyxl插入数据和折线图[copy xlsxwriter].xlsx&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>获取 sheet1，复制一个给 sheet2 参数，然后改下 sheet2 的标题 title，这个 title 就是文件的 sheet2 的名字。</p><h2 id="追加数据内容" tabindex="-1"><a class="header-anchor" href="#追加数据内容" aria-hidden="true">#</a> 追加数据内容</h2><h2 id="第三个需求-sheet2-中-数据1-和数据2-追加一年的数据-数据可以随意生成" tabindex="-1"><a class="header-anchor" href="#第三个需求-sheet2-中-数据1-和数据2-追加一年的数据-数据可以随意生成" aria-hidden="true">#</a> 第三个需求，sheet2 中，数据1 和数据2 追加一年的数据，数据可以随意生成</h2><p>貌似简单，但是年份时间不好计算，并且现在只有 2019 年的。如果之前数据是 2018 年，则追加一年，应该是 2019 年，所以要读取时间和月份追加。</p><p>这里的难点就是时间字符串的读取，以及字符串转时间，以及时间的相加。</p><p>如下实现代码：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> openpyxl<span class="token punctuation">,</span> random<span class="token punctuation">,</span> datetime
<span class="token keyword">from</span> dateutil<span class="token punctuation">.</span>relativedelta <span class="token keyword">import</span> relativedelta
filename <span class="token operator">=</span> <span class="token string">&#39;xlsxwriter插入数据和折线图.xlsx&#39;</span>
wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

sheet1 <span class="token operator">=</span> wb<span class="token punctuation">[</span><span class="token string">&#39;sheet1&#39;</span><span class="token punctuation">]</span>
sheet2 <span class="token operator">=</span> wb<span class="token punctuation">.</span>copy_worksheet<span class="token punctuation">(</span>sheet1<span class="token punctuation">)</span>
sheet2<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;sheet2&quot;</span>

rows <span class="token operator">=</span> sheet2<span class="token punctuation">.</span>max_row <span class="token comment"># 读取最后一行</span>
prev_date_str <span class="token operator">=</span> sheet2<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>rows<span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token comment"># 取出时间的字符串</span>
prev_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>prev_date_str<span class="token punctuation">,</span> <span class="token string">&quot;%Y-%m&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 时间字符串转时间对象</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp_date <span class="token operator">=</span> prev_date <span class="token operator">+</span> relativedelta<span class="token punctuation">(</span>months<span class="token operator">=</span>i<span class="token punctuation">)</span> <span class="token comment"># 月份的计算，每次增加一个月，就得到了第二年的12个月</span>
    tmp_num1 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
    tmp_num2 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
    sheet2<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>tmp_date<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&quot;%Y-%m&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tmp_num1<span class="token punctuation">,</span> tmp_num2<span class="token punctuation">]</span><span class="token punctuation">)</span>

wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">&#39;poenpyxl插入数据和折线图[copy xlsxwriter].xlsx&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现思路：</p><ul><li>读取出最后一行</li><li>取出时间字符串，然后转换成时间对象</li><li>一年 12 个月，循环 12 次，每次增加一个月，数值可以随机的生成，用 random 即可</li><li>数据的追加，是按每行，所以将【时间， 数据1， 数据2】通过 append 直接追加到数据最后即可</li></ul><p>第三个需求搞定，下一个需求，sheet2 画折线图</p><h2 id="使用-openpyxl-画图表" tabindex="-1"><a class="header-anchor" href="#使用-openpyxl-画图表" aria-hidden="true">#</a> 使用 openpyxl 画图表</h2><h3 id="第四个需求-在-sheet2-中对全部数据画折线图" tabindex="-1"><a class="header-anchor" href="#第四个需求-在-sheet2-中对全部数据画折线图" aria-hidden="true">#</a> 第四个需求，在 sheet2 中对全部数据画折线图</h3><p>这个难度不大，只要知道 openpyxl 的画图工具即可，如下代码：</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> openpyxl<span class="token punctuation">,</span> random<span class="token punctuation">,</span> datetime
<span class="token keyword">from</span> dateutil<span class="token punctuation">.</span>relativedelta <span class="token keyword">import</span> relativedelta
filename <span class="token operator">=</span> <span class="token string">&#39;xlsxwriter插入数据和折线图.xlsx&#39;</span>
wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

sheet1 <span class="token operator">=</span> wb<span class="token punctuation">[</span><span class="token string">&#39;sheet1&#39;</span><span class="token punctuation">]</span>
sheet2 <span class="token operator">=</span> wb<span class="token punctuation">.</span>copy_worksheet<span class="token punctuation">(</span>sheet1<span class="token punctuation">)</span>
sheet2<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;sheet2&quot;</span>

rows <span class="token operator">=</span> sheet2<span class="token punctuation">.</span>max_row
prev_date_str <span class="token operator">=</span> sheet2<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span>rows<span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
prev_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>prev_date_str<span class="token punctuation">,</span> <span class="token string">&quot;%Y-%m&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp_date <span class="token operator">=</span> prev_date <span class="token operator">+</span> relativedelta<span class="token punctuation">(</span>months<span class="token operator">=</span>i<span class="token punctuation">)</span>
    tmp_num1 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
    tmp_num2 <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
    sheet2<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>tmp_date<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&quot;%Y-%m&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tmp_num1<span class="token punctuation">,</span> tmp_num2<span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment"># 下面是画折线图的实现代码</span>
<span class="token keyword">from</span> openpyxl<span class="token punctuation">.</span>chart <span class="token keyword">import</span> Series<span class="token punctuation">,</span>LineChart<span class="token punctuation">,</span> Reference
chart <span class="token operator">=</span> LineChart<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#图表对象</span>
rows <span class="token operator">=</span> sheet2<span class="token punctuation">.</span>max_row

data1 <span class="token operator">=</span> Reference<span class="token punctuation">(</span>sheet2<span class="token punctuation">,</span> min_col<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> min_row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> max_col<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> max_row<span class="token operator">=</span>rows<span class="token punctuation">)</span> <span class="token comment">#涉及数据</span>
title1 <span class="token operator">=</span> sheet2<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
seriesObj1 <span class="token operator">=</span> Series<span class="token punctuation">(</span>data1<span class="token punctuation">,</span> title<span class="token operator">=</span>title1<span class="token punctuation">)</span>  <span class="token comment">#创建series对象</span>

data2 <span class="token operator">=</span> Reference<span class="token punctuation">(</span>sheet2<span class="token punctuation">,</span> min_col<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> min_row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> max_col<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> max_row<span class="token operator">=</span>rows<span class="token punctuation">)</span> <span class="token comment">#涉及数据</span>
title2 <span class="token operator">=</span> sheet2<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>column<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value
seriesObj2 <span class="token operator">=</span> Series<span class="token punctuation">(</span>data2<span class="token punctuation">,</span> title<span class="token operator">=</span>title2<span class="token punctuation">)</span>  <span class="token comment">#创建series对象</span>

chart<span class="token punctuation">.</span>append<span class="token punctuation">(</span>seriesObj1<span class="token punctuation">)</span>  <span class="token comment">#添加到chart中</span>
chart<span class="token punctuation">.</span>append<span class="token punctuation">(</span>seriesObj2<span class="token punctuation">)</span>  <span class="token comment">#添加到chart中</span>

sheet2<span class="token punctuation">.</span>add_chart<span class="token punctuation">(</span>chart<span class="token punctuation">,</span> <span class="token string">&quot;E3&quot;</span><span class="token punctuation">)</span> <span class="token comment">#将图表添加到 sheet中</span>


wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">&#39;poenpyxl插入数据和折线图[copy xlsxwriter].xlsx&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>导入所需的画图工具，图表初始化，然后生成数据对象：</p><ul><li>data1 的生成，因为索引从1开始，所以标题是第一行第二列，数据是第二行第二列，一直到最后一行第二列</li><li>data2 的生成，因为索引从1开始，所以标题是第一行第三列，数据是第二行第三列，一直到第二行最后三列</li><li>将两个数据都放到图表内</li><li>然后图表的开始位置，设置成 E3，数据在 ABC，E 是空的，3 距离顶部有两格的位置</li></ul><p>最后文件保存，大功告成。</p><h2 id="查看最后的效果图" tabindex="-1"><a class="header-anchor" href="#查看最后的效果图" aria-hidden="true">#</a> 查看最后的效果图</h2><p>然后就是用 Office 打开 poenpyxl 插入数据和折线图[copy xlsxwriter].xlsx，看下 sheet2 的样子，如下图：</p><p><img src="`+r+'" alt="3" loading="lazy"></p><p>25 行数据，除了标题 24 行，刚好是 2019+2020 的 24 个月。折线图也一切正常。</p><p>欢迎关注我公众号：AI悦创，有更多更好玩的等你发现！</p><details class="custom-container details"><summary>公众号：AI悦创【二维码】</summary><p><img src="'+e+'" alt="" loading="lazy"></p></details>',40),m={class:"custom-container info"},v=n("p",{class:"custom-container-title"},"AI悦创·编程一对一",-1),h=n("p",null,"AI悦创·推出辅导班啦，包括「Python 语言辅导班、C++ 辅导班、java 辅导班、算法/数据结构辅导班、少儿编程、pygame 游戏开发」，全部都是一对一教学：一对一辅导 + 一对一答疑 + 布置作业 + 项目实践等。当然，还有线下线上摄影课程、Photoshop、Premiere 一对一教学、QQ、微信在线，随时响应！微信：Jiabcdefh",-1),b=n("p",null,"C++ 信息奥赛题解，长期更新！长期招收一对一中小学信息奥赛集训，莆田、厦门地区有机会线下上门，其他地区线上。微信：Jiabcdefh",-1),x={href:"http://wpa.qq.com/msgrd?v=3&uin=1432803776&site=qq&menu=yes",target:"_blank",rel:"noopener noreferrer"},_=n("p",null,"方法二：微信：Jiabcdefh",-1),w=n("p",null,[n("img",{src:t,alt:"",loading:"lazy"})],-1);function y(g,f){const a=u("ExternalLinkIcon");return o(),c("div",null,[k,n("div",m,[v,h,b,n("p",null,[s("方法一："),n("a",x,[s("QQ"),l(a)])]),_]),w])}const j=p(d,[["render",y],["__file","auto_base12.html.vue"]]);export{j as default};
