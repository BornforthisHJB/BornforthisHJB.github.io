---
title: 17-强大的装饰器
icon: python
date: 2023-08-01 12:07:09
author: AI悦创
isOriginal: true
category: Python 进阶
tag:
    - Python 进阶
sticky: false
star: false
article: true
timeline: true
image: false
navbar: true
sidebarIcon: true
headerDepth: 5
comment: true
lastUpdated: true
editLink: false
backToTop: true
toc: true
---

![](./17.assets/dc830dd58d35cfd9025bfea084aeec0f.jpg)

你好，我是悦创。

装饰器一直以来都是 Python 中很有用、很经典的一个 feature，在工程中的应用也十分广泛，比如日志、缓存等等的任务都会用到。然而，在平常工作生活中，我发现不少人，尤其是初学者，常常因为其相对复杂的表示，对装饰器望而生畏，认为它“too fancy to learn”，实际并不如此。

今天这节课，我会以前面所讲的函数、闭包为切入点，引出装饰器的概念、表达和基本用法，最后，再通过实际工程中的例子，让你再次加深理解。

接下来，让我们进入正文一起学习吧！

## 1. 函数 -> 装饰器

### 1.1 函数核心回顾

引入装饰器之前，我们首先一起来复习一下，必须掌握的函数的几个核心概念。

第一点，我们要知道，在 Python 中，函数是一等公民（first-class citizen），函数也是对象。我们可以把函数赋予变量，比如下面这段代码：

```python
def func(message):
    print('Got a message: {}'.format(message))
    
send_message = func
send_message('hello world')

# 输出
Got a message: hello world
```

这个例子中，我们把函数 func 赋予了变量 `send_message`，这样之后你调用 `send_message`，就相当于是调用函数 `func()`。

第二点，我们可以把函数当作参数，传入另一个函数中，比如下面这段代码：

```python
def get_message(message):
    return 'Got a message: ' + message


def root_call(func, message):
    print(func(message))
    
root_call(get_message, 'hello world')

# 输出
Got a message: hello world
```

这个例子中，我们就把函数 `get_message` 以参数的形式，传入了函数 `root_call()` 中然后调用它。

第三点，我们可以在函数里定义函数，也就是函数的嵌套。这里我同样举了一个例子：

```python
def func(message):
    def get_message(message):
        print('Got a message: {}'.format(message))
    return get_message(message)

func('hello world')

# 输出
Got a message: hello world
```

这段代码中，我们在函数 `func()` 里又定义了新的函数 `get_message()`，调用后作为 `func()` 的返回值返回。

第四点，要知道，函数的返回值也可以是函数对象（闭包），比如下面这个例子：

```python
def func_closure():
    def get_message(message):
        print('Got a message: {}'.format(message))
    return get_message

send_message = func_closure()
send_message('hello world')

# 输出
Got a message: hello world
```

这里，函数 `func_closure()` 的返回值是函数对象 `get_message` 本身，之后，我们将其赋予变量 `send_message`，再调用 `send_message(‘hello world’)`，最后输出了`'Got a message: hello world'`。

### 1.2 简单的装饰器

简单的复习之后，我们接下来学习今天的新知识——装饰器。按照习惯，我们可以先来看一个装饰器的简单例子：

```python
def my_decorator(func):
    def wrapper():
        print('wrapper of decorator')
        func()
    return wrapper

def greet():
    print('hello world')

greet = my_decorator(greet)
greet()

# 输出
wrapper of decorator
hello world
```

这段代码中，变量 greet 指向了内部函数 `wrapper()`，而内部函数 `wrapper()` 中又会调用原函数 `greet()`，因此，最后调用 `greet()` 时，就会先打印`'wrapper of decorator'`，然后输出`'hello world'`。

这里的函数 `my_decorator()` 就是一个装饰器，它把真正需要执行的函数 `greet()` 包裹在其中，并且改变了它的行为，但是原函数 `greet()` 不变。

事实上，上述代码在 Python 中有更简单、更优雅的表示：

```python
def my_decorator(func):
    def wrapper():
        print('wrapper of decorator')
        func()
    return wrapper

@my_decorator
def greet():
    print('hello world')

greet()
```

这里的`@`，我们称之为语法糖，`@my_decorator` 就相当于前面的 `greet=my_decorator(greet)` 语句，只不过更加简洁。因此，如果你的程序中有其它函数需要做类似的装饰，你只需在它们的上方加上 `@decorator` 就可以了，这样就大大提高了函数的重复利用和程序的可读性。

### 1.3 带有参数的装饰器

你或许会想到，如果原函数 `greet()` 中，有参数需要传递给装饰器怎么办？

一个简单的办法，是可以在对应的装饰器函数 `wrapper()` 上，加上相应的参数，比如：

```python
def my_decorator(func):
    def wrapper(message):
        print('wrapper of decorator')
        func(message)
    return wrapper


@my_decorator
def greet(message):
    print(message)


greet('hello world')

# 输出
wrapper of decorator
hello world
```

不过，新的问题来了。如果我另外还有一个函数，也需要使用 `my_decorator()` 装饰器，但是这个新的函数有两个参数，又该怎么办呢？比如：

```python
@my_decorator
def celebrate(name, message):
    ...
```

事实上，通常情况下，我们会把 `*args` 和 `**kwargs` ，作为装饰器内部函数 `wrapper()` 的参数。`*args` 和 `**kwargs`，表示接受任意数量和类型的参数，因此装饰器就可以写成下面的形式：

```python
def my_decorator(func):
    def wrapper(*args, **kwargs):
        print('wrapper of decorator')
        func(*args, **kwargs)
    return wrapper
```

### 1.4 带有自定义参数的装饰器

其实，装饰器还有更大程度的灵活性。刚刚说了，装饰器可以接受原函数任意类型和数量的参数，除此之外，它还可以接受自己定义的参数。

























欢迎关注我公众号：AI悦创，有更多更好玩的等你发现！

::: details 公众号：AI悦创【二维码】

![](/gzh.jpg)

:::

::: info AI悦创·编程一对一

AI悦创·推出辅导班啦，包括「Python 语言辅导班、C++ 辅导班、java 辅导班、算法/数据结构辅导班、少儿编程、pygame 游戏开发」，全部都是一对一教学：一对一辅导 + 一对一答疑 + 布置作业 + 项目实践等。当然，还有线下线上摄影课程、Photoshop、Premiere 一对一教学、QQ、微信在线，随时响应！微信：Jiabcdefh

C++ 信息奥赛题解，长期更新！长期招收一对一中小学信息奥赛集训，莆田、厦门地区有机会线下上门，其他地区线上。微信：Jiabcdefh

方法一：[QQ](http://wpa.qq.com/msgrd?v=3&uin=1432803776&site=qq&menu=yes)

方法二：微信：Jiabcdefh

:::

![](/zsxq.jpg)

